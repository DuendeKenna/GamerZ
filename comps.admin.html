<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Administrador de Vectores de Productos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:ital,wght@0,400;0,700;1,400&family=Press+Start+2P&family=Saira:wght@400;900;1,400&family=VT323&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111827; /* Fondo principal de Manual de Marca */
            color: #e5e7eb; /* Color de texto principal de Manual de Marca */
        }
        .font-saira { font-family: 'Saira', sans-serif; }
        .font-saira-black { font-family: 'Saira', sans-serif; font-weight: 900; }
        .font-press-start { font-family: 'Press Start 2P', cursive; }
        .font-vt323 { font-family: 'VT323', monospace; }

        .product-card {
            background-color: #1f2937; /* Color de contenedor de Manual de Marca */
            border-radius: 0.75rem; /* rounded-xl */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); /* shadow-md */
            padding: 1.5rem; /* p-6 */
            margin-bottom: 1rem; /* mb-4 */
            border: 1px solid #374151; /* border-gray-700 */
            cursor: grab; /* Indica que el elemento es arrastrable */
        }
        .product-card.dragging {
            opacity: 0.5;
            border: 2px dashed #6366f1; /* Borde para el elemento arrastrado */
        }
        .product-card.drag-over {
            border: 2px solid #a855f7; /* Borde para el objetivo de soltar */
        }
        /* Style for the "Add New Product" card */
        .add-product-card {
            background-color: #374151; /* A slightly different background */
            border: 2px dashed #6366f1; /* Dashed border for visual distinction */
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 200px; /* Ensure it's large enough to click */
            cursor: pointer;
            transition: background-color 0.2s ease, border-color 0.2s ease;
        }
        .add-product-card:hover {
            background-color: #4b5563;
            border-color: #4f46e5;
        }
        .add-product-card button {
            background-color: transparent;
            border: none;
            color: #6366f1;
            font-weight: 600;
            font-size: 1.125rem; /* text-lg */
            display: flex;
            align-items: center;
            padding: 0.5rem 1rem;
        }
        .add-product-card button .lucide-icon {
            margin-right: 0.5rem;
        }


        input[type="text"], input[type="number"], textarea {
            background-color: #374151; /* bg-gray-700 */
            border: 1px solid #4b5563; /* border-gray-600 */
            color: #e5e7eb; /* text-gray-200 */
            border-radius: 0.375rem; /* rounded-md */
            padding: 0.5rem 0.75rem; /* px-3 py-2 */
            width: 100%;
            font-size: 0.875rem; /* text-sm */
            line-height: 1.25rem; /* leading-5 */
            outline: none;
            transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
        }
        input[type="text"]:focus, input[type="number"]:focus, textarea:focus {
            border-color: #6366f1; /* focus:border-indigo-500 */
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.25); /* focus:ring-indigo-500 */
        }
        input[type="file"] {
            color: #e5e7eb; /* text-gray-200 */
            font-size: 0.875rem; /* text-sm */
        }
        input[type="file"]::file-selector-button {
            background-color: #4b5563; /* bg-gray-600 */
            color: #ffffff; /* text-white */
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            border: none;
            cursor: pointer;
            transition: background-color 0.2s ease-in-out;
            margin-right: 0.5rem;
        }
        input[type="file"]::file-selector-button:hover {
            background-color: #374151; /* hover:bg-gray-700 */
        }

        .btn-primary {
            background-color: #6366f1; /* bg-indigo-500 */
            color: #ffffff; /* text-white */
            padding: 0.75rem 1.25rem; /* px-5 py-3 */
            border-radius: 0.5rem; /* rounded-lg */
            font-weight: 600; /* font-semibold */
            transition: background-color 0.2s ease-in-out;
            cursor: pointer;
        }
        .btn-primary:hover {
            background-color: #4f46e5; /* hover:bg-indigo-600 */
        }
        .btn-danger {
            background-color: #ef4444; /* bg-red-500 */
            color: #ffffff; /* text-white */
            padding: 0.5rem 1rem; /* px-4 py-2 */
            border-radius: 0.375rem; /* rounded-md */
            font-weight: 500; /* font-medium */
            transition: background-color 0.2s ease-in-out;
            cursor: pointer;
        }
        .btn-danger:hover {
            background-color: #dc2626; /* hover:bg-red-600 */
        }
        .btn-secondary {
            background-color: #4b5563; /* bg-gray-600 */
            color: #ffffff; /* text-white */
            padding: 0.5rem 1rem; /* px-4 py-2 */
            border-radius: 0.375rem; /* rounded-md */
            font-weight: 500; /* font-medium */
            transition: background-color 0.2s ease-in-out;
            cursor: pointer;
        }
        .btn-secondary:hover {
            background-color: #374151; /* hover:bg-gray-700 */
        }
        .lucide-icon {
            display: inline-block;
            vertical-align: middle;
            width: 1em;
            height: 1em;
            stroke-width: 2;
            stroke: currentColor;
            fill: none;
            stroke-linecap: round;
            stroke-linejoin: round;
        }
        .section-title-admin {
            border-bottom: 3px solid;
            border-image: linear-gradient(to right, #6366f1, #a855f7) 1;
            padding-bottom: 0.5rem;
            display: inline-block;
        }
        #output-code {
            background-color: #1f2937; /* bg-gray-800 */
            border-color: #374151; /* border-gray-700 */
            color: #42d232; /* green-333 */
        }
        #copy-message {
            color: #42d232; /* green-333 */
        }
        #error-message {
            color: #ef4444; /* red-500 */
        }
        .propagate-btn {
            background-color: #22d3ee; /* cyan-400 */
            color: #111827; /* Fondo principal */
            padding: 0.3rem 0.6rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s ease-in-out;
            margin-left: 0.5rem;
            white-space: nowrap; /* Evita que el texto se rompa */
        }
        .propagate-btn:hover {
            background-color: #06b6d4; /* cyan-500 */
        }
        .input-group {
            display: flex;
            align-items: center;
            gap: 0.5rem; /* Espacio entre input y bot√≥n */
        }
        .input-group input, .input-group textarea {
            flex-grow: 1; /* Permite que el input ocupe el espacio disponible */
        }
        /* Clase para el efecto de flash en la imagen */
        .image-flash {
            border-color: #42d232 !important; /* green-333 */
            box-shadow: 0 0 0 3px rgba(66, 210, 50, 0.5); /* Sombra verde */
            transition: box-shadow 0.2s ease-in-out, border-color 0.2s ease-in-out;
        }

        /* Tab Styles */
        .tab-buttons {
            display: flex;
            margin-bottom: 1.5rem;
            border-bottom: 2px solid #374151; /* gray-700 */
            overflow-x: auto; /* Allow horizontal scrolling if many tabs */
            -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS */
        }
        .tab-button {
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            color: #9ca3af; /* gray-400 */
            background-color: transparent;
            border: none;
            cursor: pointer;
            transition: color 0.2s ease, border-color 0.2s ease;
            border-bottom: 2px solid transparent;
            white-space: nowrap; /* Prevent text wrapping */
        }
        .tab-button:hover {
            color: #e5e7eb; /* gray-200 */
        }
        .tab-button.active {
            color: #6366f1; /* indigo-500 */
            border-color: #6366f1; /* indigo-500 */
        }
        .tab-content {
            padding-top: 1rem;
        }

        /* Table specific styles for overview */
        .overview-table th, .overview-table td {
            padding: 0.75rem 1.5rem; /* px-6 py-3 */
            vertical-align: top; /* Align content to top for multi-line textarea */
        }
        .overview-table input[type="text"],
        .overview-table input[type="number"],
        .overview-table textarea {
            background-color: transparent;
            border: 1px solid transparent; /* Make border transparent by default */
            border-radius: 0.25rem; /* rounded-sm */
            padding: 0.25rem 0.5rem; /* px-2 py-1 */
            font-size: 0.875rem; /* text-sm */
            color: #e5e7eb; /* text-gray-200 */
            transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
            min-width: 80px; /* Ensure inputs don't collapse too much */
        }
        .overview-table input[type="text"]:focus,
        .overview-table input[type="number"]:focus,
        .overview-table textarea:focus {
            border-color: #4b5563; /* gray-600 */
            box-shadow: 0 0 0 1px rgba(75, 85, 99, 0.5); /* subtle shadow */
        }
        .overview-table textarea {
            min-height: 40px; /* Ensure description textarea has some height */
        }
        .add-row-button-cell {
            text-align: center;
            padding-top: 1rem;
            padding-bottom: 1rem;
        }
        .add-row-button {
            background-color: #6366f1;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        .add-row-button:hover {
            background-color: #4f46e5;
        }
    </style>
</head>
<body class="p-4 md:p-8 bg-gray-900 min-h-screen text-gray-200">
    <div class="max-w-6xl mx-auto bg-gray-800 p-6 md:p-8 rounded-xl shadow-lg border border-gray-700">
        <h1 class="text-3xl font-saira-black text-white mb-6 text-center">Administrador de Vectores de Productos</h1>

        <div class="tab-buttons">
            <button class="tab-button active" id="tab-initial-load-view" data-tab="initial-load-view">Cargar Datos Iniciales</button>
            <button class="tab-button" id="tab-detailed-view" data-tab="detailed-view">Vista Detallada</button>
            <button class="tab-button" id="tab-overview-view" data-tab="overview-view">Vista General (Tablas)</button>
        </div>

        <div id="initial-load-view" class="tab-content">
            <section class="mb-8 p-6 bg-gray-900 rounded-lg shadow-sm border border-gray-700">
                <h2 class="text-2xl font-semibold text-gray-100 mb-4 section-title-admin">Cargar Datos Iniciales</h2>
                <p class="text-gray-400 mb-4">Pega aqu√≠ el c√≥digo JSON de tus vectores de productos. Este JSON debe ser un objeto con las claves de cada categor√≠a y sus respectivos arrays de productos.</p>
                <textarea id="initial-data-input" rows="15" class="w-full p-4 border border-gray-700 rounded-lg bg-gray-700 text-gray-200 font-mono text-sm resize-y"></textarea>
                <div class="flex justify-center mt-4 space-x-4">
                    <button id="load-data-button" class="btn-primary flex items-center">
                        <span class="lucide-icon mr-2" data-lucide="upload"></span> Cargar Datos
                    </button>
                    <button id="paste-data-button" class="btn-secondary flex items-center">
                        <span class="lucide-icon mr-2" data-lucide="clipboard"></span> Pegar Datos
                    </button>
                </div>
                <p id="error-message" class="text-center text-sm text-red-500 mt-2 hidden">Error al cargar los datos. Aseg√∫rate de que el formato sea correcto.</p>
            </section>
        </div>

        <div id="detailed-view" class="tab-content hidden">
            <section id="section-towers" class="mb-8 p-6 bg-gray-900 rounded-lg shadow-sm border border-gray-700">
                <h2 class="text-2xl font-semibold text-gray-100 mb-4 section-title-admin">Torres</h2>
                <div id="towers-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mt-4"></div>
            </section>

            <section id="section-ssdOptions" class="mb-8 p-6 bg-gray-900 rounded-lg shadow-sm border border-gray-700">
                <h2 class="text-2xl font-semibold text-gray-100 mb-4 section-title-admin">Opciones de SSD</h2>
                <div id="ssdOptions-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mt-4"></div>
            </section>

            <section id="section-gpuOptions" class="mb-8 p-6 bg-gray-900 rounded-lg shadow-sm border border-gray-700">
                <h2 class="text-2xl font-semibold text-gray-100 mb-4 section-title-admin">Opciones de GPU</h2>
                <div id="gpuOptions-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mt-4"></div>
            </section>

            <section id="section-psuOptions" class="mb-8 p-6 bg-gray-900 rounded-lg shadow-sm border border-gray-700">
                <h2 class="text-2xl font-semibold text-gray-100 mb-4 section-title-admin">Opciones de PSU</h2>
                <div id="psuOptions-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mt-4"></div>
            </section>

            <section id="section-motherboardOptions" class="mb-8 p-6 bg-gray-900 rounded-lg shadow-sm border border-gray-700">
                <h2 class="text-2xl font-semibold text-gray-100 mb-4 section-title-admin">Opciones de Motherboard</h2>
                <div id="motherboardOptions-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mt-4"></div>
            </section>

            <section id="section-cpuOptions" class="mb-8 p-6 bg-gray-900 rounded-lg shadow-sm border border-gray-700">
                <h2 class="text-2xl font-semibold text-gray-100 mb-4 section-title-admin">Opciones de CPU</h2>
                <div id="cpuOptions-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mt-4"></div>
            </section>

            <section id="section-ramOptions" class="mb-8 p-6 bg-gray-900 rounded-lg shadow-sm border border-gray-700">
                <h2 class="text-2xl font-semibold text-gray-100 mb-4 section-title-admin">Opciones de RAM</h2>
                <div id="ramOptions-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mt-4"></div>
            </section>

            <section id="section-comboOptions" class="mb-8 p-6 bg-gray-900 rounded-lg shadow-sm border border-gray-700">
                <h2 class="text-2xl font-semibold text-gray-100 mb-4 section-title-admin">Opciones de Combo</h2>
                <div id="comboOptions-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mt-4"></div>
            </section>
            
            <section id="section-monitorOptions" class="mb-8 p-6 bg-gray-900 rounded-lg shadow-sm border border-gray-700">
                <h2 class="text-2xl font-semibold text-gray-100 mb-4 section-title-admin">Opciones de Monitor</h2>
                <div id="monitorOptions-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mt-4"></div>
            </section>

            <section id="section-mouseOptions" class="mb-8 p-6 bg-gray-900 rounded-lg shadow-sm border border-gray-700">
                <h2 class="text-2xl font-semibold text-gray-100 mb-4 section-title-admin">Opciones de Mouse</h2>
                <div id="mouseOptions-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mt-4"></div>
            </section>

            <section id="section-joystickOptions" class="mb-8 p-6 bg-gray-900 rounded-lg shadow-sm border border-gray-700">
                <h2 class="text-2xl font-semibold text-gray-100 mb-4 section-title-admin">Opciones de Joystick</h2>
                <div id="joystickOptions-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mt-4"></div>
            </section>

            <section id="section-keyboardOptions" class="mb-8 p-6 bg-gray-900 rounded-lg shadow-sm border border-gray-700">
                <h2 class="text-2xl font-semibold text-gray-100 mb-4 section-title-admin">Opciones de Teclado</h2>
                <div id="keyboardOptions-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mt-4"></div>
            </section>
            
            <section id="section-comboMouseTecladoOptions" class="mb-8 p-6 bg-gray-900 rounded-lg shadow-sm border border-gray-700">
                <h2 class="text-2xl font-semibold text-gray-100 mb-4 section-title-admin">Opciones de Combo Mouse y Teclado</h2>
                <div id="comboMouseTecladoOptions-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mt-4"></div>
            </section>

            <section id="section-auricularesOptions" class="mb-8 p-6 bg-gray-900 rounded-lg shadow-sm border border-gray-700">
                <h2 class="text-2xl font-semibold text-gray-100 mb-4 section-title-admin">Opciones de Auriculares</h2>
                <div id="auricularesOptions-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mt-4"></div>
            </section>

            <section id="section-parlantesOptions" class="mb-8 p-6 bg-gray-900 rounded-lg shadow-sm border border-gray-700">
                <h2 class="text-2xl font-semibold text-gray-100 mb-4 section-title-admin">Opciones de Parlantes</h2>
                <div id="parlantesOptions-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mt-4"></div>
            </section>
            </div>

        <div id="overview-view" class="tab-content hidden">
            </div>

        <section class="mt-10 p-6 bg-gray-900 rounded-lg shadow-inner border border-gray-700">
            <h2 class="text-2xl font-semibold text-gray-100 mb-4 text-center section-title-admin">Generar y Copiar C√≥digo de Vectores</h2>
            <textarea id="output-code" rows="15" class="w-full p-4 border border-gray-700 rounded-lg bg-gray-800 text-green-400 font-mono text-sm resize-y" readonly></textarea>
            <div class="flex flex-col sm:flex-row justify-center mt-4 space-y-4 sm:space-y-0 sm:space-x-4">
                <button onclick="generateCode()" class="btn-primary flex items-center justify-center">
                    <span class="lucide-icon mr-2" data-lucide="code"></span> Generar C√≥digo
                </button>
                <button onclick="copyCode()" class="btn-secondary flex items-center justify-center">
                    <span class="lucide-icon mr-2" data-lucide="copy"></span> Copiar C√≥digo
                </button>
            </div>
            <p id="copy-message" class="text-center text-sm text-green-500 mt-2 hidden">¬°C√≥digo copiado al portapapeles!</p>
            <p id="warning-message" class="text-center text-sm text-amber-400 mt-2 hidden">¬°Advertencia: Las im√°genes cargadas localmente asumen que el archivo estar√° en la carpeta 'comps/' de tu servidor!</p>
        </section>
    </div>

    <script>
        // Variables globales para los datos de los productos
        let towersOptions = [];
        let ssdOptions = [];
        let gpuOptions = [];
        let psuOptions = [];
        let motherboardOptions = [];
        let cpuOptions = [];
        let ramOptions = [];
        let comboOptions = [];
        let monitorOptions = [];
        let mouseOptions = [];
        let joystickOptions = [];
        let keyboardOptions = [];
        let comboMouseTecladoOptions = []; // Nueva propiedad
        let auricularesOptions = [];     // Nueva propiedad
        let parlantesOptions = [];       // Nueva propiedad

        // Objeto para mapear nombres de categor√≠as a sus arrays de datos.
        // Es la √öNICA fuente de verdad para los datos en la aplicaci√≥n.
        const dataMap = {
            towers: towersOptions,
            ssdOptions: ssdOptions,
            gpuOptions: gpuOptions,
            psuOptions: psuOptions,
            motherboardOptions: motherboardOptions,
            cpuOptions: cpuOptions,
            ramOptions: ramOptions,
            comboOptions: comboOptions,
            monitorOptions: monitorOptions,
            mouseOptions: mouseOptions,
            joystickOptions: joystickOptions,
            keyboardOptions: keyboardOptions,
            comboMouseTecladoOptions: comboMouseTecladoOptions, // Nueva propiedad
            auricularesOptions: auricularesOptions,           // Nueva propiedad
            parlantesOptions: parlantesOptions              // Nueva propiedad
        };

        // Mapeo de categor√≠as a sus carpetas de im√°genes
        const categoryFolderMap = {
            towers: 'torres',
            ssdOptions: 'discos',
            gpuOptions: 'gpus',
            psuOptions: 'psus',
            motherboardOptions: 'motherboards',
            cpuOptions: 'cpus',
            ramOptions: 'ram',
            comboOptions: 'combos',
            monitorOptions: 'monitores',
            mouseOptions: 'mouses',
            joystickOptions: 'joysticks',
            keyboardOptions: 'teclados',
            comboMouseTecladoOptions: 'combos-mouse-teclado', // Nueva propiedad
            auricularesOptions: 'auriculares',               // Nueva propiedad
            parlantesOptions: 'parlantes'                  // Nueva propiedad
        };

        // Flag para rastrear cambios no guardados en la sesi√≥n
        let hasUnsavedChanges = false;

        // Variables para el drag and drop
        let draggedItemCategory = null;
        let draggedItemIndex = null;

        /**
         * Helper para obtener el nombre legible del componente.
         * @param {string} type - El tipo de componente (ej. 'towers').
         * @returns {string} El nombre legible.
         */
        function getComponentName(type) {
            switch (type) {
                case 'towers': return 'Torre';
                case 'ssdOptions': return 'SSD';
                case 'gpuOptions': return 'GPU';
                case 'psuOptions': return 'PSU';
                case 'motherboardOptions': return 'Motherboard';
                case 'cpuOptions': return 'CPU';
                case 'ramOptions': return 'RAM';
                case 'comboOptions': return 'Combo';
                case 'monitorOptions': return 'Monitor';
                case 'mouseOptions': return 'Mouse';
                case 'joystickOptions': return 'Joystick';
                case 'keyboardOptions': return 'Teclado';
                case 'comboMouseTecladoOptions': return 'Combo Mouse y Teclado'; // Nueva propiedad
                case 'auricularesOptions': return 'Auricular';                   // Nueva propiedad
                case 'parlantesOptions': return 'Parlante';                    // Nueva propiedad
                default: return 'Componente';
            }
        }

        /**
         * Muestra un mensaje de error en la UI.
         * @param {string} message - El mensaje de error a mostrar.
         */
        function showErrorMessage(message) {
            const errorMessageElement = document.getElementById('error-message');
            errorMessageElement.textContent = message;
            errorMessageElement.classList.remove('hidden');
            setTimeout(() => {
                errorMessageElement.classList.add('hidden');
            }, 5000);
        }

        /**
         * Muestra un mensaje de advertencia en la UI.
         * @param {string} message - El mensaje de advertencia a mostrar.
         */
        function showWarningMessage(message) {
            const warningMessageElement = document.getElementById('warning-message');
            warningMessageElement.textContent = message;
            warningMessageElement.classList.remove('hidden');
            setTimeout(() => {
                warningMessageElement.classList.add('hidden');
            }, 7000);
        }

        /**
         * Guarda el estado actual de los datos en sessionStorage.
         */
        function saveDataToSessionStorage() {
            try {
                // Genera el objeto de datos a partir de dataMap
                const dataToStore = {
                    towersOptions: dataMap.towers,
                    ssdOptions: dataMap.ssdOptions,
                    gpuOptions: dataMap.gpuOptions,
                    psuOptions: dataMap.psuOptions,
                    motherboardOptions: dataMap.motherboardOptions,
                    cpuOptions: dataMap.cpuOptions,
                    ramOptions: dataMap.ramOptions,
                    comboOptions: dataMap.comboOptions,
                    monitorOptions: dataMap.monitorOptions,
                    mouseOptions: dataMap.mouseOptions,
                    joystickOptions: dataMap.joystickOptions,
                    keyboardOptions: dataMap.keyboardOptions,
                    comboMouseTecladoOptions: dataMap.comboMouseTecladoOptions, // Nueva propiedad
                    auricularesOptions: dataMap.auricularesOptions,           // Nueva propiedad
                    parlantesOptions: dataMap.parlantesOptions              // Nueva propiedad
                };
                sessionStorage.setItem('productAdminData', JSON.stringify(dataToStore));
                hasUnsavedChanges = true;
            } catch (e) {
                console.error("Error al guardar en sessionStorage:", e);
            }
        }

        /**
         * Carga los datos desde sessionStorage si existen.
         * @returns {Object|null} The loaded data or null if none.
         */
        function loadDataFromSessionStorage() {
            try {
                const storedData = sessionStorage.getItem('productAdminData');
                return storedData ? JSON.parse(storedData) : null;
            } catch (e) {
                console.error("Error al cargar de sessionStorage:", e);
                sessionStorage.removeItem('productAdminData');
                return null;
            }
        }

        /**
         * Carga los datos desde el textarea de entrada inicial.
         */
        function loadDataFromInput() {
            const initialDataInput = document.getElementById('initial-data-input');
            try {
                const dataString = initialDataInput.value;
                if (!dataString.trim()) {
                    showErrorMessage('El campo de datos est√° vac√≠o.');
                    return;
                }
                const parsedData = JSON.parse(dataString);

                // Carga los datos en el dataMap, asegurando que sean arrays
                dataMap.towers = parsedData.towersOptions || [];
                dataMap.ssdOptions = parsedData.ssdOptions || [];
                dataMap.gpuOptions = parsedData.gpuOptions || [];
                dataMap.psuOptions = parsedData.psuOptions || [];
                dataMap.motherboardOptions = parsedData.motherboardOptions || [];
                dataMap.cpuOptions = parsedData.cpuOptions || [];
                dataMap.ramOptions = parsedData.ramOptions || [];
                dataMap.comboOptions = parsedData.comboOptions || [];
                dataMap.monitorOptions = parsedData.monitorOptions || [];
                dataMap.mouseOptions = parsedData.mouseOptions || [];
                dataMap.joystickOptions = parsedData.joystickOptions || [];
                dataMap.keyboardOptions = parsedData.keyboardOptions || [];
                dataMap.comboMouseTecladoOptions = parsedData.comboMouseTecladoOptions || []; // Nueva propiedad
                dataMap.auricularesOptions = parsedData.auricularesOptions || [];           // Nueva propiedad
                dataMap.parlantesOptions = parsedData.parlantesOptions || [];             // Nueva propiedad


                // Refresca las vistas y guarda en sesi√≥n
                renderAllProducts();
                renderOverviewTables();
                saveDataToSessionStorage();
                hasUnsavedChanges = true;
                document.getElementById('error-message').classList.add('hidden');
                showWarningMessage("Datos cargados y aplicados desde el editor.");
            } catch (error) {
                console.error('Error al parsear los datos iniciales:', error);
                showErrorMessage('Error al cargar los datos. Aseg√∫rate de que el formato JSON sea correcto.');
            }
        }

        /**
         * Pega el contenido del portapapeles en el textarea de carga inicial.
         */
        async function pasteDataIntoInput() {
            const initialDataInput = document.getElementById('initial-data-input');
            try {
                const text = await navigator.clipboard.readText();
                initialDataInput.value = text;
                showWarningMessage('¬°Datos pegados! Haz clic en "Cargar Datos" para aplicar los cambios.');
            } catch (err)
                {
                console.error('Error al pegar del portapapeles:', err);
                showErrorMessage('No se pudo acceder al portapapeles. Por favor, pega los datos manualmente (Ctrl+V o Cmd+V).');
            }
        }

        /**
         * Maneja la carga de archivos de imagen.
         */
        async function handleImageUpload(event, category, index, keyToUpdate) {
            const file = event.target.files[0];
            if (!file) return;

            const categoryFolder = categoryFolderMap[category];
            const relativePath = `comps/${categoryFolder}/${file.name}`;

            dataMap[category][index][keyToUpdate] = relativePath;
            event.target.value = '';

            updateProductCard(category, index);
            saveDataToSessionStorage();
            showWarningMessage('¬°Advertencia: Las im√°genes cargadas localmente asumen que el archivo estar√° en la carpeta \'comps/\' de tu servidor!');

            const cardElement = document.getElementById(`product-card-${category}-${index}`);
            if (cardElement) {
                const imageUrlInput = cardElement.querySelector(`input[oninput*="updateProduct('${category}', ${index}, 'image_url'"]`);
                if (imageUrlInput) {
                    showPropagateButton(imageUrlInput);
                }
            }
        }

        /**
         * Muestra el bot√≥n de propagaci√≥n.
         */
        function showPropagateButton(inputElement) {
            const propagateBtn = inputElement.closest('.input-group').querySelector('.propagate-btn');
            if (propagateBtn) {
                propagateBtn.classList.remove('hidden');
            }
        }

        /**
         * Oculta el bot√≥n de propagaci√≥n.
         */
        function hidePropagateButton(inputElement) {
            const propagateBtn = inputElement.closest('.input-group').querySelector('.propagate-btn');
            if (propagateBtn) {
                setTimeout(() => {
                    propagateBtn.classList.add('hidden');
                }, 150);
            }
        }

        /**
         * Propaga y formatea los datos del producto bas√°ndose en un campo de origen.
         */
        function propagateProductData(category, index, sourceField) {
            const product = dataMap[category][index];
            let baseName = '';

            if (sourceField === 'name') {
                baseName = product.name || '';
            } else if (sourceField === 'slug') {
                baseName = (product.slug || '').replace(/[-_]/g, ' ').split(' ').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ');
            } else if (sourceField === 'image_url') {
                const imageUrl = product.image_url || '';
                const parts = imageUrl.split('/');
                let filename = parts[parts.length - 1];
                filename = filename.replace(/\.(webp|png|jpg|jpeg|gif)$/i, '');
                baseName = filename.replace(/[-_]/g, ' ').split(' ').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ');
            }

            if (!baseName) {
                showErrorMessage('No se pudo derivar un nombre base para propagar.');
                return;
            }

            const formattedName = baseName.split(' ').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ');
            product.name = formattedName;

            if (category === 'towers') {
                product.slug = formattedName.toLowerCase().replace(/\s+/g, '-');
            }

            const categoryFolder = categoryFolderMap[category];
            const formattedSlugForImage = formattedName.toLowerCase().replace(/\s+/g, '-');
            product.image_url = `comps/${categoryFolder}/${formattedSlugForImage}.webp`;

            updateProductCard(category, index);
            saveDataToSessionStorage();
            showWarningMessage('¬°Datos propagados! Recuerda que las URLs de imagen asumen la carpeta "comps/" y extensi√≥n ".webp".');
        }


        /**
         * Genera el HTML para una sola tarjeta de producto.
         */
        function generateProductCardHtml(category, product, index) {
            const timestamp = new Date().getTime();
            const actualImageUrl = product.image_url || '';
            const imageUrlToDisplay = actualImageUrl ? `${actualImageUrl}?t=${timestamp}` : 'https://placehold.co/100x100/374151/9ca3af?text=Sin+Imagen';
            const altText = `Imagen de ${product.name || 'Producto'} - Ruta: ${actualImageUrl}`;

            let fieldsHtml = '';
            
            fieldsHtml += `
                <label class="block text-sm font-medium text-gray-400">Nombre:</label>
                <div class="input-group mb-2">
                    <input type="text" value="${product.name || ''}"
                           oninput="updateProduct('${category}', ${index}, 'name', this.value)"
                           onfocus="showPropagateButton(this)" onblur="hidePropagateButton(this)">
                    <button class="propagate-btn hidden" onclick="propagateProductData('${category}', ${index}, 'name')">Propagar</button>
                </div>
            `;

            fieldsHtml += `
                <label class="block text-sm font-medium text-gray-400">Precio:</label>
                <input type="number" value="${product.price || 0}" oninput="updateProduct('${category}', ${index}, 'price', parseFloat(this.value))" class="mb-2">
            `;

            if (category === 'towers') {
                fieldsHtml += `
                    <label class="block text-sm font-medium text-gray-400">Slug:</label>
                    <div class="input-group mb-2">
                        <input type="text" value="${product.slug || ''}"
                               oninput="updateProduct('${category}', ${index}, 'slug', this.value)"
                               onfocus="showPropagateButton(this)" onblur="hidePropagateButton(this)">
                        <button class="propagate-btn hidden" onclick="propagateProductData('${category}', ${index}, 'slug')">Propagar</button>
                    </div>
                `;
            }
            
            if (category !== 'towers') {
                 fieldsHtml += `
                    <label class="block text-sm font-medium text-gray-400">Descripci√≥n:</label>
                    <textarea rows="2" oninput="updateProduct('${category}', ${index}, 'description', this.value)" class="mb-2">${product.description || ''}</textarea>
                `;
            }

            fieldsHtml += `
                <label class="block text-sm font-medium text-gray-400">URL de Imagen:</label>
                <div class="input-group mb-2">
                    <input type="file" id="file-input-${category}-${index}" accept="image/*" class="hidden" onchange="handleImageUpload(event, '${category}', ${index}, 'image_url')">
                    <button onclick="document.getElementById('file-input-${category}-${index}').click()" class="btn-secondary text-xs py-1 px-2 flex items-center">
                        <span class="lucide-icon mr-1" data-lucide="image"></span> Subir Archivo
                    </button>
                    <input type="text" value="${product.image_url || ''}"
                           oninput="updateProduct('${category}', ${index}, 'image_url', this.value)"
                           onfocus="showPropagateButton(this)" onblur="hidePropagateButton(this)"
                           class="text-xs" placeholder="o pega una URL aqu√≠">
                    <button class="propagate-btn hidden" onclick="propagateProductData('${category}', ${index}, 'image_url')">Propagar</button>
                </div>
                <img id="img-${category}-${index}" src="${imageUrlToDisplay}" alt="${altText}" class="w-24 h-24 object-cover rounded-md border border-gray-600 mb-2" onerror="this.onerror=null;this.src='https://placehold.co/100x100/374151/9ca3af?text=Error+Carga';">
            `;

            fieldsHtml += `
                <label class="block text-sm font-medium text-gray-400">Link (URL):</label>
                <input type="text" value="${product.link || ''}" oninput="updateProduct('${category}', ${index}, 'link', this.value)" class="mb-2">
                ${product.link ? `<a href="${product.link}" target="_blank" class="text-blue-400 hover:underline text-sm flex items-center mt-1"><span class="lucide-icon mr-1" data-lucide="external-link"></span> Visitar Link</a>` : ''}
            `;

            return `
                <div class="flex justify-end mb-2">
                    <button onclick="removeProduct('${category}', ${index})" class="btn-danger text-xs py-1 px-2">
                        <span class="lucide-icon" data-lucide="trash-2"></span> Eliminar
                    </button>
                </div>
                ${fieldsHtml}
            `;
        }

        /**
         * Renderiza las tarjetas de productos para una categor√≠a espec√≠fica.
         */
        function renderProducts(category, dataArray) {
            const container = document.getElementById(`${category}-container`);
            if (!container) return;
            container.innerHTML = '';

            dataArray.forEach((product, index) => {
                const card = document.createElement('div');
                card.id = `product-card-${category}-${index}`;
                card.setAttribute('draggable', 'true');
                card.dataset.category = category;
                card.dataset.index = index;
                card.className = 'product-card flex flex-col space-y-3';
                card.innerHTML = generateProductCardHtml(category, product, index);
                container.appendChild(card);
            });

            const addCard = document.createElement('div');
            addCard.className = 'product-card add-product-card';
            addCard.setAttribute('draggable', 'false');
            addCard.onclick = () => addProduct(category);
            addCard.innerHTML = `
                <button>
                    <span class="lucide-icon" data-lucide="plus"></span> A√±adir ${getComponentName(category)}
                </button>
            `;
            container.appendChild(addCard);

            lucide.createIcons();
            addDragDropListeners(category);
        }

        /**
         * Actualiza solo una tarjeta de producto espec√≠fica en el DOM.
         */
        function updateProductCard(category, index) {
            const cardElement = document.getElementById(`product-card-${category}-${index}`);
            if (cardElement) {
                const product = dataMap[category][index];
                cardElement.innerHTML = generateProductCardHtml(category, product, index);
                cardElement.setAttribute('draggable', 'true');
                cardElement.dataset.category = category;
                cardElement.dataset.index = index;

                lucide.createIcons();

                const imgElement = cardElement.querySelector(`#img-${category}-${index}`);
                if (imgElement) {
                    imgElement.classList.add('image-flash');
                    setTimeout(() => {
                        imgElement.classList.remove('image-flash');
                    }, 1000);
                }
            }
        }

        /**
         * Actualiza una propiedad de un producto en el array de datos.
         */
        function updateProduct(category, index, key, value) {
            dataMap[category][index][key] = value;
            saveDataToSessionStorage();

            if (key === 'image_url' || key === 'link') {
                updateProductCard(category, index);
            }
        }

        /**
         * A√±ade un nuevo producto a una categor√≠a.
         */
        function addProduct(category) {
            let newProduct;
            const componentName = getComponentName(category);
            const placeholderImageUrl = `https://placehold.co/100x100/374151/9ca3af?text=Nuevo+${componentName.replace(' ', '+')}`;
            
            if (category === 'towers') {
                newProduct = {
                    name: `Nuevo ${componentName}`,
                    price: 0,
                    slug: `nuevo-${componentName.toLowerCase()}`,
                    image_url: placeholderImageUrl,
                    link: ''
                };
            } else {
                newProduct = {
                    name: `Nuevo ${componentName}`,
                    price: 0,
                    description: `Descripci√≥n del nuevo ${componentName}.`,
                    image_url: placeholderImageUrl,
                    link: ''
                };
            }

            dataMap[category].push(newProduct);
            const activeTab = document.querySelector('.tab-button.active').dataset.tab;
            openTab(activeTab);
            saveDataToSessionStorage();
        }

        /**
         * Elimina un producto de una categor√≠a.
         */
        function removeProduct(category, index) {
            if (confirm('¬øEst√°s seguro de que quieres eliminar este producto?')) {
                dataMap[category].splice(index, 1);
                const activeTab = document.querySelector('.tab-button.active').dataset.tab;
                openTab(activeTab);
                saveDataToSessionStorage();
            }
        }

        /**
         * Genera el c√≥digo JSON con los datos actuales y lo devuelve como string.
         * Tambi√©n actualiza el textarea de salida.
         * @returns {string} El c√≥digo JSON formateado.
         */
        function generateCode() {
            const outputTextArea = document.getElementById('output-code');
            const fullData = {
                towersOptions: dataMap.towers,
                ssdOptions: dataMap.ssdOptions,
                gpuOptions: dataMap.gpuOptions,
                psuOptions: dataMap.psuOptions,
                motherboardOptions: dataMap.motherboardOptions,
                cpuOptions: dataMap.cpuOptions,
                ramOptions: dataMap.ramOptions,
                comboOptions: dataMap.comboOptions,
                monitorOptions: dataMap.monitorOptions,
                mouseOptions: dataMap.mouseOptions,
                joystickOptions: dataMap.joystickOptions,
                keyboardOptions: dataMap.keyboardOptions,
                comboMouseTecladoOptions: dataMap.comboMouseTecladoOptions, // Nueva propiedad
                auricularesOptions: dataMap.auricularesOptions,           // Nueva propiedad
                parlantesOptions: dataMap.parlantesOptions              // Nueva propiedad
            };
            const jsonString = JSON.stringify(fullData, null, 4);
            outputTextArea.value = jsonString;
            return jsonString;
        }

        /**
         * Copia el c√≥digo generado al portapapeles.
         */
        function copyCode() {
            const outputTextArea = document.getElementById('output-code');
            generateCode(); // Asegurarse de que el textarea tiene el c√≥digo m√°s reciente
            outputTextArea.select();
            document.execCommand('copy');
            const copyMessage = document.getElementById('copy-message');
            copyMessage.classList.remove('hidden');
            setTimeout(() => {
                copyMessage.classList.add('hidden');
            }, 2000);
        }

        /**
         * Renderiza todos los productos para todas las categor√≠as.
         */
        function renderAllProducts() {
            for (const categoryKey in dataMap) {
                renderProducts(categoryKey, dataMap[categoryKey]);
            }
        }

        /**
         * Renderiza las tablas de vista general para todas las categor√≠as.
         */
        function renderOverviewTables() {
            const overviewContainer = document.getElementById('overview-view');
            overviewContainer.innerHTML = '';

            for (const categoryKey in dataMap) {
                const categoryData = dataMap[categoryKey];
                const readableCategoryName = getComponentName(categoryKey) + 's';

                const categoryDiv = document.createElement('div');
                categoryDiv.className = 'mb-8 p-6 bg-gray-900 rounded-lg shadow-sm border border-gray-700';
                categoryDiv.innerHTML = `<h3 class="text-xl font-semibold text-gray-100 mb-4">${readableCategoryName}</h3>`;

                const table = document.createElement('table');
                table.className = 'overview-table w-full text-left text-sm text-gray-400';
                table.innerHTML = `
                    <thead class="text-xs text-gray-200 uppercase bg-gray-700">
                        <tr>
                            <th scope="col" class="px-6 py-3">Nombre</th>
                            <th scope="col" class="px-6 py-3">Precio</th>
                            ${categoryKey === 'towers' ? '<th scope="col" class="px-6 py-3">Slug</th>' : ''}
                            ${categoryKey !== 'towers' ? '<th scope="col" class="px-6 py-3">Descripci√≥n</th>' : ''}
                            <th scope="col" class="px-6 py-3">URL Imagen</th>
                            <th scope="col" class="px-6 py-3">Link</th>
                            <th scope="col" class="px-6 py-3">Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${categoryData.map((product, index) => `
                            <tr class="bg-gray-800 border-b border-gray-700 hover:bg-gray-700 transition-colors duration-200">
                                <td class="px-6 py-4 font-medium text-white whitespace-nowrap">
                                    <input type="text" value="${product.name || ''}" oninput="updateProduct('${categoryKey}', ${index}, 'name', this.value)" class="w-full bg-transparent border-none focus:ring-0">
                                </td>
                                <td class="px-6 py-4">
                                    <input type="number" value="${product.price || 0}" oninput="updateProduct('${categoryKey}', ${index}, 'price', parseFloat(this.value))" class="w-full bg-transparent border-none focus:ring-0">
                                </td>
                                ${categoryKey === 'towers' ? `
                                <td class="px-6 py-4">
                                    <input type="text" value="${product.slug || ''}" oninput="updateProduct('${categoryKey}', ${index}, 'slug', this.value)" class="w-full bg-transparent border-none focus:ring-0">
                                </td>` : ''}
                                ${categoryKey !== 'towers' ? `
                                <td class="px-6 py-4">
                                    <textarea rows="1" oninput="updateProduct('${categoryKey}', ${index}, 'description', this.value)" class="w-full bg-transparent border-none focus:ring-0 resize-none">${product.description || ''}</textarea>
                                </td>` : ''}
                                <td class="px-6 py-4">
                                    <input type="text" value="${product.image_url || ''}" oninput="updateProduct('${categoryKey}', ${index}, 'image_url', this.value)" class="w-full bg-transparent border-none focus:ring-0 text-xs">
                                </td>
                                <td class="px-6 py-4">
                                    <input type="text" value="${product.link || ''}" oninput="updateProduct('${categoryKey}', ${index}, 'link', this.value)" class="w-full bg-transparent border-none focus:ring-0 text-xs">
                                    ${product.link ? `<a href="${product.link}" target="_blank" class="text-blue-400 hover:underline text-xs flex items-center mt-1"><span class="lucide-icon w-3 h-3 mr-1" data-lucide="external-link"></span></a>` : ''}
                                </td>
                                <td class="px-6 py-4 text-right">
                                    <button onclick="removeProduct('${categoryKey}', ${index})" class="btn-danger text-xs py-1 px-2">
                                        <span class="lucide-icon w-4 h-4" data-lucide="trash-2"></span>
                                    </button>
                                </td>
                            </tr>
                        `).join('')}
                        <tr>
                            <td colspan="7" class="add-row-button-cell">
                                <button onclick="addProduct('${categoryKey}')" class="add-row-button">
                                    <span class="lucide-icon mr-2" data-lucide="plus"></span> A√±adir ${getComponentName(categoryKey)}
                                </button>
                            </td>
                        </tr>
                    </tbody>
                `;
                categoryDiv.appendChild(table);
                overviewContainer.appendChild(categoryDiv);
            }
            lucide.createIcons();
        }

        /**
         * Funci√≥n para abrir una pesta√±a espec√≠fica.
         */
        function openTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.add('hidden'));
            document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
            document.getElementById(tabName).classList.remove('hidden');
            document.querySelector(`.tab-button[data-tab="${tabName}"]`).classList.add('active');

            if (tabName === 'detailed-view') {
                renderAllProducts();
            } else if (tabName === 'overview-view') {
                renderOverviewTables();
            }
            lucide.createIcons();
        }


        // --- Funciones de Drag and Drop ---
        function handleDragStart(e) {
            const targetTagName = e.target.tagName;
            if (['INPUT', 'TEXTAREA', 'BUTTON'].includes(targetTagName) || e.target.closest('button')) {
                e.preventDefault();
                return;
            }
            const card = e.target.closest('.product-card');
            if (!card || card.classList.contains('add-product-card')) {
                e.preventDefault();
                return;
            }
            draggedItemCategory = card.dataset.category;
            draggedItemIndex = parseInt(card.dataset.index);
            e.dataTransfer.effectAllowed = 'move';
            card.classList.add('dragging');
        }

        function handleDragOver(e) {
            e.preventDefault();
            const targetCard = e.target.closest('.product-card');
            if (targetCard && !targetCard.classList.contains('add-product-card') && targetCard.dataset.category === draggedItemCategory) {
                if (targetCard.id !== `product-card-${draggedItemCategory}-${draggedItemIndex}`) {
                    targetCard.classList.add('drag-over');
                }
            }
        }

        function handleDragLeave(e) {
            const targetCard = e.target.closest('.product-card');
            if (targetCard) {
                targetCard.classList.remove('drag-over');
            }
        }

        function handleDrop(e) {
            e.preventDefault();
            const targetCard = e.target.closest('.product-card');
            if (targetCard && !targetCard.classList.contains('add-product-card')) {
                targetCard.classList.remove('drag-over');
                const targetCategory = targetCard.dataset.category;
                const targetIndex = parseInt(targetCard.dataset.index);
                if (draggedItemCategory === targetCategory && draggedItemIndex !== targetIndex) {
                    const currentArray = dataMap[draggedItemCategory];
                    const [draggedProduct] = currentArray.splice(draggedItemIndex, 1);
                    currentArray.splice(targetIndex, 0, draggedProduct);
                    renderProducts(draggedItemCategory, currentArray);
                    saveDataToSessionStorage();
                }
            }
        }

        function handleDragEnd(e) {
            document.querySelectorAll('.dragging, .drag-over').forEach(el => {
                el.classList.remove('dragging', 'drag-over');
            });
            draggedItemCategory = null;
            draggedItemIndex = null;
        }

        /**
         * A√±ade los listeners de drag and drop a todas las tarjetas de una categor√≠a.
         */
        function addDragDropListeners(category) {
            const container = document.getElementById(`${category}-container`);
            if (!container) return;
            container.querySelectorAll('.product-card:not(.add-product-card)').forEach(card => {
                card.addEventListener('dragstart', handleDragStart);
                card.addEventListener('dragover', handleDragOver);
                card.addEventListener('dragleave', handleDragLeave);
                card.addEventListener('drop', handleDrop);
                card.addEventListener('dragend', handleDragEnd);
            });
        }

        // Inicializar la p√°gina al cargar el DOM
        document.addEventListener('DOMContentLoaded', async () => {
            let dataToLoad = null;
            const storedData = loadDataFromSessionStorage();

            if (storedData) {
                dataToLoad = storedData;
                hasUnsavedChanges = true;
                showWarningMessage('¬°Datos restaurados de la sesi√≥n anterior!');
            } else {
                try {
                    const response = await fetch('products.json');
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    dataToLoad = await response.json();
                    hasUnsavedChanges = false;
                    showWarningMessage('¬°Datos cargados desde products.json!');
                } catch (error) {
                    console.error('Error al cargar products.json:', error);
                    showErrorMessage('Error al cargar products.json. Se iniciar√° con datos vac√≠os.');
                    hasUnsavedChanges = false;
                }
            }

            // Poblar dataMap a partir de los datos cargados (o iniciar vac√≠o)
            if (dataToLoad) {
                dataMap.towers = dataToLoad.towersOptions || [];
                dataMap.ssdOptions = dataToLoad.ssdOptions || [];
                dataMap.gpuOptions = dataToLoad.gpuOptions || [];
                dataMap.psuOptions = dataToLoad.psuOptions || [];
                dataMap.motherboardOptions = dataToLoad.motherboardOptions || [];
                dataMap.cpuOptions = dataToLoad.cpuOptions || [];
                dataMap.ramOptions = dataToLoad.ramOptions || [];
                dataMap.comboOptions = dataToLoad.comboOptions || [];
                dataMap.monitorOptions = dataToLoad.monitorOptions || [];
                dataMap.mouseOptions = dataToLoad.mouseOptions || [];
                dataMap.joystickOptions = dataToLoad.joystickOptions || [];
                dataMap.keyboardOptions = dataToLoad.keyboardOptions || [];
                dataMap.comboMouseTecladoOptions = dataToLoad.comboMouseTecladoOptions || []; // Nueva propiedad
                dataMap.auricularesOptions = dataToLoad.auricularesOptions || [];           // Nueva propiedad
                dataMap.parlantesOptions = dataToLoad.parlantesOptions || [];             // Nueva propiedad
            } else {
                Object.keys(dataMap).forEach(key => dataMap[key] = []);
            }

            // Poblar el textarea de carga inicial con los datos actuales
            const initialDataInput = document.getElementById('initial-data-input');
            initialDataInput.value = generateCode();

            // A√±adir event listeners a los botones
            document.getElementById('load-data-button').addEventListener('click', loadDataFromInput);
            document.getElementById('paste-data-button').addEventListener('click', pasteDataIntoInput);
            document.getElementById('tab-initial-load-view').addEventListener('click', () => openTab('initial-load-view'));
            document.getElementById('tab-detailed-view').addEventListener('click', () => openTab('detailed-view'));
            document.getElementById('tab-overview-view').addEventListener('click', () => openTab('overview-view'));

            // Abrir la pesta√±a por defecto y renderizar iconos
            openTab('initial-load-view');
            lucide.createIcons();
        });

    </script>
</body>
</html>