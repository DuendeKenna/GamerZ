<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>La Nave del Medio</title>
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>✨</text></svg>">
    <!-- El uso del CDN de Tailwind es adecuado para desarrollo y prototipado. Para producción, se recomienda instalarlo como un plugin de PostCSS. -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&family=Press+Start+2P&family=Saira:wght@400;700;900&family=VT323&family=Roboto:wght@400;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="https://code.iconify.design/1/1.0.7/iconify.min.js"></script>
    <style>
        :root {
            --color-link: #60a5fa;
            /* azul brillante */
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Inter', sans-serif;
            overflow-x: hidden;
            /* Prevent horizontal scroll */
            background-image: url('covers_wall.webp');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
        }

        h1,
        h2 {
            font-family: 'Saira', sans-serif;
        }

        /* --- Custom Brand Colors --- */
        .green-222 {
            color: #95ef81;
        }

        .green-333 {
            color: #42d232;
        }

        .green-777 {
            color: #107c10;
        }

        .blueish {
            color: #0098e9;
        }

        /* --- Custom Software Checkbox --- */
        .custom-software-checkbox {
            width: 1.25rem;
            /* w-5 */
            height: 1.25rem;
            /* h-5 */
            border-radius: 0.375rem;
            /* rounded-md */
            border: 2px solid #6b7280;
            /* border-gray-500 */
            background-color: #374151;
            /* bg-gray-700 */
            transition: all 0.2s ease-in-out;
            flex-shrink: 0;
            position: relative;
        }

        .custom-software-checkbox.checked {
            background-color: #42d232;
            /* green-333 */
            border-color: #95ef81;
            /* green-222 */
        }

        .custom-software-checkbox.checked::after {
            content: '\2714';
            color: white;
            font-size: 0.9rem;
            font-weight: bold;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        /* --- Font Families --- */
        .font-gamer {
            font-family: 'Press Start 2P', cursive;
        }

        .font-vt323 {
            font-family: 'VT323', monospace;
        }

        .font-saira {
            font-family: 'Saira', sans-serif;
        }

        .font-roboto {
            font-family: 'Roboto', sans-serif;
        }

        /* --- Brand Specific Styles --- */
        .brand-title {
            position: relative;
            font-weight: 900;
            background: linear-gradient(to right, #6366f1, #a855f7);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            z-index: 1;
        }

        .special-subtitle {
            font-family: 'Saira';
            letter-spacing: 0.03em;
            background: linear-gradient(to top, #bd570e, #e9bb06);
            border-radius: 25px;
            color: rgb(41, 1, 1) !important;
            box-shadow: rgba(0, 0, 0, 0.849) 0px 0px 50px;
        }

        .special-subtitle:hover {
            background: linear-gradient(to right, #fb923c, #b9a333);
        }

        /* --- Card Effects (Games) --- */
        .card-game {
            position: relative;
        }

        .card-game label {
            position: relative;
            overflow: hidden;
            display: block;
            border-radius: 0.75rem;
            transition: transform 0.3s ease;
            aspect-ratio: 3/4;
        }

        .card-game label::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom right,
                    rgba(255, 255, 255, 0.4) 0%,
                    rgba(255, 255, 255, 0.15) 50%,
                    rgba(0, 0, 0, 0.15) 50%,
                    rgba(0, 0, 0, 0.4) 100%);
            border-radius: 0.75rem;
            pointer-events: none;
            mix-blend-mode: overlay;
            transition: opacity 0.3s ease-in-out;
            opacity: 1;
        }

        .card-game label:hover::after,
        .card-game input:checked+label::after {
            opacity: 1;
        }

        .card-game label img {
            transition: filter 0.3s ease;
            filter: grayscale(33%);
        }

        .card-game label:hover,
        .card-game input:checked+label {
            transform: scale(1.07);
            z-index: 10;
        }

        .card-game input:checked+label img {
            filter: grayscale(0%) brightness(1.1);
        }

        .card-game input:checked+label {
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.5);
        }

        /* --- Game Title Sticker --- */
        .game-title-sticker {
            position: absolute;
            background: linear-gradient(to right, #ef4444, #f97316);
            padding: 0.2rem 0.6rem;
            border-radius: 4px;
            font-weight: 700;
            font-size: 0.75rem;
            color: white;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
            text-align: center;
            max-width: 80%;
            transition: opacity 0.2s ease-in-out;
            z-index: 10;
        }

        /* --- Error Toast Animation --- */
        #error-toast {
            position: fixed;
            bottom: -150px;
            left: 50%;
            transform: translateX(-50%);
            transition: bottom 0.4s ease-out, opacity 0.4s ease-out;
            opacity: 0;
            z-index: 50;
            width: calc(100% - 2rem);
            max-width: 400px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4);
        }

        #error-toast.show {
            bottom: 20px;
            opacity: 1;
        }

        /* --- Price Badge --- */
        .launch-badge {
            position: absolute;
            top: -24px;
            left: 50%;
            transform: translateX(-50%) rotate(6deg);
            background: linear-gradient(to right, #b12020a4, #cf5f0e);
            padding: 0.2rem 0.5rem;
            border-radius: 6px;
            font-weight: 700;
            letter-spacing: 0.05em;
            font-size: 0.9rem;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4);
            white-space: nowrap;
        }

        @media (min-width: 768px) {
            .launch-badge {
                left: auto;
                right: -42px;
                transform: rotate(6deg);
            }
        }

        /* --- Animated Games Card Background --- */
        .animated-bg-games {
            min-height: 480px;
            box-shadow: inset 0 0 12px 4px rgba(0, 0, 0, 0.55);
        }

        .animated-bg-games::before {
            content: '';
            position: absolute;
            top: -10%;
            left: -10%;
            width: 120%;
            height: 120%;
            background-image: url('wall_covers_sm.jpeg');
            background-size: 250%;
            animation:
                ping-pong-path 45s ease-in-out infinite,
                blur-and-fade 10s ease-in-out infinite alternate;
            z-index: 0;
        }

        .animated-bg-games>* {
            position: relative;
            z-index: 1;
        }

        @keyframes ping-pong-path {
            0% {
                background-position: 0% 0%;
            }

            25% {
                background-position: 100% 0%;
            }

            50% {
                background-position: 100% 100%;
            }

            75% {
                background-position: 0% 100%;
            }

            100% {
                background-position: 0% 0%;
            }
        }

        @keyframes blur-and-fade {
            from {
                filter: blur(0px);
                opacity: 0.15;
            }

            to {
                filter: blur(2px);
                opacity: 0.3;
            }
        }


        /* --- Neon Highlight (Using brand color) --- */
        .neon-green-highlight {
            border: 2px solid #42d23291;
            box-shadow: 0 0 15px #42d23294, inset 0 0 10px rgba(66, 210, 50, 0.3);
            color: #f0fdf4;
        }

        /* --- CTA Button (WhatsApp Brand Aligned) --- */
        .cta-button {
            animation: glow-whatsapp 4s ease-in-out infinite;
            background: linear-gradient(to right, #25D366, #128C7E);
            border: 2px solid #075e54;
            transition: all 0.3s ease;
        }

        .cta-button:hover {
            background: linear-gradient(to right, #29e66d, #15a589);
            transform: scale(1.05);
        }

        @keyframes glow-whatsapp {

            0%,
            100% {
                box-shadow: 0 0 4px #25D366, 0 0 8px #128C7E, 0 0 12px #075e54;
            }

            50% {
                box-shadow: 0 0 8px #25D366, 0 0 15px #128C7E, 0 0 25px #075e54;
            }
        }

        #games-section {
            padding-bottom: 0px;
        }

        /* --- "Ver más" Neon Button --- */
        .load-more-button {
            background: transparent;
            color: #42d232;
            opacity: 0.6;
            border: 6px solid #107c10;
            border-radius: 15px;
            padding: 20px 35px;
            letter-spacing: 5px;
            cursor: pointer;
            font-weight: bold;
            filter: drop-shadow(0 0 15px #42d232) drop-shadow(0 0 50px #42d232) contrast(2) brightness(2);
            transition: .5s;
        }

        .load-more-button:hover {
            color: black;
            background-color: #42d232;
            filter: drop-shadow(0 0 20px #42d232) contrast(2) brightness(2);
        }

        /* --- Essential Software Highlight --- */
        .essential-software {
            background-color: rgba(66, 210, 50, 0.1);
            border-left: 3px solid #42d232;
        }

        /* --- Animation & Misc --- */
        .animate-float {
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {

            0%,
            100% {
                transform: translateY(0) translateX(0);
            }

            25% {
                transform: translateY(-5px) translateX(2px);
            }

            50% {
                transform: translateY(0) translateX(-2px);
            }

            75% {
                transform: translateY(5px) translateX(0);
            }
        }

        .lucas-price {
            font-size: 4rem;
            line-height: 1;
            font-weight: bold;
            color: #22d3ee;
            animation: price-glow 3s ease-in-out infinite;
            text-shadow: solid 3px 3px black;
        }

        @keyframes price-glow {

            0%,
            100% {
                text-shadow: 2px 2px 55px rgba(0, 0, 0, 0.5), 0 0 20px rgba(118, 18, 143, 0.801), 0 0 55px rgba(34, 211, 238, 0.2), 0 0 25px rgba(34, 211, 238, 0.2);
            }

            50% {
                text-shadow: 2px 2px 55px rgba(0, 0, 0, 0.5), 0 0 12px rgba(34, 211, 238, 0.35), 0 0 25px rgba(34, 211, 238, 0.25);
            }
        }

        .offer-banner-main,
        .offer-banner-contado {
            position: absolute;
            left: 50%;
            color: #ffffff;
            padding: 0.2rem 1rem;
            border-radius: 0.375rem;
            text-shadow: 1px 1px 2px rgb(0 0 0 / 50%);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
            white-space: nowrap;
        }

        .offer-banner-main {
            background: linear-gradient(to right, #f97316, #fb923c);
            font-size: 1.3rem;
            animation: banner-swing-main 2.5s ease-in-out infinite alternate;
            transform: translateX(-50%) rotate(-7deg);
            bottom: 0;
        }

        .offer-banner-contado {
            background: #c2410c;
            font-size: 1.1rem;
            z-index: 10;
            animation: banner-swing-contado 2.5s ease-in-out infinite alternate;
            transform: translateX(-60%) rotate(-12deg);
            bottom: 2.2rem;
        }

        @keyframes banner-swing-contado {
            from {
                transform: translateX(-60%) rotate(-10deg);
            }

            to {
                transform: translateX(-60%) rotate(0deg);
            }
        }

        /* Hook section highlight */
        .hook-section strong {
            color: #42d232;
            text-shadow: 1px 1px 0 black;
        }

        .hook-section p {
            text-shadow: 2px 2px 3px black;
        }

        .hook-section .font-normal {
            font-family: 'Inter', sans-serif;
        }

        .load-more-container {
            padding-bottom: 4rem;
            margin-top: -4rem;
            background-color: #111827;
        }

        /* --- Feature Cards --- */
        .feature-card {
            background-color: rgba(31, 41, 55, 0.4);
            border: 1px solid rgba(75, 85, 99, 0.5);
            border-radius: 0.75rem;
            padding: 1.25rem 1rem;
            min-height: 160px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(4px);
            -webkit-backdrop-filter: blur(4px);
            transition: all 0.3s ease-in-out;
            position: relative;
            overflow: hidden;
        }

        .feature-card:hover {
            transform: translateY(-5px) scale(1.03);
            background-color: rgba(55, 65, 81, 0.7);
            border-color: rgba(34, 211, 238, 0.5);
            box-shadow: 0 0 20px rgba(34, 211, 238, 0.15);
        }

        .animated-bg-games:hover {
            box-shadow: 0 0 20px rgba(34, 211, 238, 0.15), inset 0 0 12px 4px rgba(0, 0, 0, 0.55);
        }

        /* --- Corner Ribbon Badge --- */
        .corner-ribbon-wrapper {
            width: 150px;
            height: 150px;
            overflow: hidden;
            position: absolute;
            top: -10px;
            right: -10px;
            z-index: 1;
        }

        .corner-ribbon {
            position: absolute;
            top: 35px;
            right: -35px;
            transform: rotate(45deg);
            width: 200px;
            background: linear-gradient(to right, #f97316, #facc15);
            font-family: 'Press Start 2P', cursive;
            font-size: 0.6rem;
            padding: 5px 0;
            text-align: center;
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.3);
            line-height: 1.2;
        }

        .corner-ribbon-text {
            color: #422006;
            text-shadow: 1px 1px 0px rgba(255, 255, 255, 0.2);
        }

        .despegue-text {
            text-shadow: 1px 1px 1px rgba(84, 0, 117, 0.2);
            letter-spacing: 1pt;
        }


        #slideshow-container {
            background-color: #353f4d;
        }

        #slideshow-container img {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: contain;
            transition: opacity 0.8s ease-in-out;
        }

        #hero-wrapper {
            position: relative;
        }

        #hero-background-in {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            background-image: url('hero-background.webp');
            background-size: cover;
            background-position: center;
            filter: invert(100%) sepia(1) saturate(1000%) hue-rotate(52deg);
            z-index: 0;
            animation: spin 33s linear infinite;
        }

        #hero-background {
            position: absolute;
            overflow: hidden;
            top: 55vh;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            animation: spin 10s ease-in-out infinite, cosmic-pulse 20s ease-in-out infinite;
        }

        @keyframes spin {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }

        @keyframes cosmic-pulse {
            0% {
                transform: scale(0.8) rotate(0deg);
                filter: blur(20px);
                opacity: 0.2;
            }

            50% {
                transform: scale(1) rotate(1deg);
                filter: blur(12px);
                opacity: 0.1;
            }

            100% {
                transform: scale(0.8) rotate(0deg);
                filter: blur(20px);
                opacity: 0.2;
            }
        }

        @keyframes float-up-down {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-10px);
            }
        }

        #ovniUp {
            position: absolute;
            left: 55%;
            top: -15px;
            opacity: 0.63;
            filter: hue-rotate(50deg);
            animation: float-up-down 4s ease-in-out infinite, energy-beam 6s ease-in-out infinite;
            z-index: 30;
        }

        @keyframes energy-beam {
            0% {
                filter: hue-rotate(5deg);
                opacity: 0.6;
            }

            50% {
                filter: hue-rotate(50deg);
                opacity: 0.8;
            }

            100% {
                filter: hue-rotate(5deg);
                opacity: 0.6;
            }
        }

        .main-container {
            background-color: #111827;
            box-shadow: 0 0 40px rgba(0, 0, 0, 0.7);
            position: relative;
            overflow: visible;
        }

        #game-grid-container {
            position: relative;
            padding-top: 1.5rem;
        }

        #game-grid-wrapper {
            overflow: hidden;
            transition: max-height 1.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            padding: 0 1rem;
        }

        #load-more-overlay {
            position: absolute;
            bottom: 0px;
            left: 0;
            width: 100%;
            height: 500px;
            background: linear-gradient(to top, #111827 25%, transparent);
            pointer-events: none;
            transition: opacity 1.5s;
        }

        footer {
            position: relative;
        }

        #memde_pointLeft {
            position: absolute;
            bottom: -20px;
            max-width: 150px;
            width: 40%;
            z-index: 0;
            overflow-x: hidden;
            left: -20px;
        }


        @media (min-width: 768px) {
            #memde_pointLeft {
                bottom: -30px;
                width: auto;
                left: 0;
                transform: translateX(50%);
            }
        }

        /* --- Software Category Description --- */
        .software-cat-desc {
            background-color: #1a1332;
            border-radius: 1rem;
            padding: 0.5rem 1rem;
            margin-bottom: 1rem;
            transition: background 0.3s, color 0.3s;
        }

        .software-card {
            background-color: #23272f;
            border-radius: 0.75rem;
            padding: 1rem;
            text-align: center;
            transition: transform 0.3s, background 0.3s;
            position: relative;
            overflow: hidden;
        }

        .software-card.selected {
            background-color: #374151;
        }

        .software-card.unselected {
            opacity: 0.7;
        }

        .software-card:hover {
            transform: translateY(-3px);
            background-color: #374151;
        }

        .software-icon {
            width: 48px;
            height: 48px;
            margin-bottom: 0.5rem;
        }

        .software-name {
            font-weight: 500;
            color: #e5e7eb;
            margin-bottom: 0.25rem;
        }

        .software-tick {
            position: absolute;
            top: 1rem;
            right: 1rem;
            color: #22c55e;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .software-card.selected .software-tick {
            opacity: 1;
        }

        /* --- Soporte Técnico (memde_think.png) Responsive --- */
        #section-front-features .feature-card.soporte-tecnico-card {
            overflow: visible !important;
        }

        #section-front-features img[src*="memde_think.png"] {
            opacity: 1;
            position: absolute;
            bottom: 0;
            right: 0;
            left: auto;
            top: auto;
            height: 80%;
            width: auto;
            pointer-events: none;
            z-index: 30;
            transition: opacity 0.3s, right 0.3s, height 0.3s;
        }

        @media (max-width: 1023px) {
            #section-front-features img[src*="memde_think.png"] {
                opacity: 0.8;
                z-index: 0;
                height: 80%;
                right: 0;
            }
        }

        @media (min-width: 1024px) {
            #section-front-features img[src*="memde_think.png"] {
                height: 115%;
                right: -2.5rem;
                bottom: 0;
                left: auto;
                top: auto;
                z-index: 40;
                opacity: 1;
            }
        }

        @media (min-width: 1280px) {
            #section-front-features img[src*="memde_think.png"] {
                right: -4rem;
                height: 115%;
                bottom: 0;
                left: auto;
                top: auto;
            }
        }

        @media (max-width: 767px) {

            #section-front-features .soporte-tecnico-card .space-y-1 p,
            #section-front-features .soporte-tecnico-card h4 {
                text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.7);
            }
        }

        /* --- Hero Product Images --- */
        .hero-crox-img {
            position: absolute;
            margin-top: -133px;
            top: 55px !important;
            pointer-events: none;
            z-index: 20;
            width: auto;
            transition: all 0.3s ease-in-out;
            will-change: transform, top, left, right;
        }

        @media (min-width: 1024px) {
            .hero-crox-img {
                height: 420px;
            }
        }

        @media (max-width: 1023px) {
            .hero-crox-img {
                height: 320px;
            }
        }

        @media (max-width: 767px) {
            .hero-crox-img {
                display: none;
            }
        }

        /* --- Tower Selector Styles --- */
        #tower-selector-container {
            position: relative;
            width: 100%;
            aspect-ratio: 4/5;
            background-color: #353f4d;
            border-radius: 0.75rem;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            overflow: visible;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.3rem;
        }

        #tower-selector-container .flex-grow {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: calc(100% - 2.5rem);
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: visible;
        }

        #current-tower-image {
            width: 100%;
            height: 125%;
            object-fit: contain;
            cursor: pointer;
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
            z-index: 1;
            margin-top: -10%;
        }

        #tower-name-and-arrows-wrapper {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 0.5rem 0;
            background-color: rgba(0, 0, 0, 0.6);
            border-top: 1px solid rgba(75, 85, 99, 0.5);
            box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.3);
            height: 2.5rem;
            z-index: 10;
        }

        #current-tower-name {
            font-family: 'Saira', sans-serif;
            font-size: 1.125rem;
            font-weight: 600;
            color: #95ef81;
            text-shadow: 0 0 3px rgba(149, 239, 129, 0.3);
            white-space: nowrap;
            padding: 0.25rem 3rem;
            background-color: transparent;
            border-radius: 0.25rem;
            z-index: 11;
        }

        .tower-nav-arrow {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background-color: rgba(66, 210, 50, 0.7);
            color: white;
            padding: 0.75rem;
            border-radius: 50%;
            cursor: pointer;
            z-index: 10;
            transition: background-color 0.3s ease, color 0.3s ease, box-shadow 0.3s ease;
            border: 2px solid #95ef81;
            box-shadow: 0 0 8px #42d232, inset 0 0 5px rgba(149, 239, 129, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            width: 3rem;
            height: 3rem;
        }

        #prev-tower {
            left: 0;
            margin-left: -1.5rem;
        }

        #next-tower {
            right: 0;
            margin-right: -1.5rem;
        }

        .tower-nav-arrow:hover {
            background-color: rgba(66, 210, 50, 1);
            color: #95ef81;
            box-shadow: 0 0 15px #42d232, inset 0 0 8px rgba(149, 239, 129, 0.5);
        }

        /* --- Sticky Price Summary Card --- */
        #price-summary-card {
            position: fixed;
            bottom: 0;
            right: 0;
            width: fit-content;
            min-width: 250px;
            padding: 1rem 1.5rem;
            background-color: rgba(31, 41, 55, 0.9);
            border-top: 1px solid rgba(75, 85, 99, 0.5);
            border-left: 1px solid rgba(75, 85, 99, 0.5);
            border-top-left-radius: 0.75rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(4px);
            -webkit-backdrop-filter: blur(4px);
            z-index: 100;
            opacity: 0;
            visibility: hidden;
            transform: translateY(100%);
            transition: opacity 0.4s ease-out, visibility 0.4s ease-out, transform 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            display: none;
        }

        @media (min-width: 768px) {
            #price-summary-card {
                display: flex;
            }
        }

        #price-summary-card.visible {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        #price-summary-card .price-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-family: 'Saira', sans-serif;
        }

        #price-summary-card .price-value-row {
            display: flex;
            align-items: baseline;
            white-space: nowrap;
        }

        #price-summary-card .currency-value {
            font-weight: bold;
            line-height: 1;
            font-size: 3.5rem;
        }

        #price-summary-card .currency-text {
            font-size: 1.75rem;
            font-weight: bold;
            line-height: 1;
            margin-left: 0.5rem;
        }

        #price-summary-card .ars-price .currency-value,
        #price-summary-card .ars-price .currency-text {
            color: #22d3ee;
            text-shadow: 2px 2px 3px black;
        }

        #price-summary-card .usd-price .currency-value,
        #price-summary-card .usd-price .currency-text {
            color: #7a3ab7;
            text-shadow: 2px 2px 3px black;
        }

        #price-summary-card .separator {
            width: 1px;
            height: 4rem;
            background-color: rgba(75, 85, 99, 0.5);
            margin: 0 1.5rem;
        }

        #total-price-summary-usd-mobile {
            font-size: 2rem;
        }

        .currency-value {
            animation: price-glow 3s ease-in-out infinite;
        }

        /* Select Styling */
        #ssd-select,
        #psu-select,
        #gpu-select {
            background-color: #374151;
            border: 1px solid #42d232;
            color: #e5e7eb;
            padding: 0.25rem 0.5rem;
            border-radius: 0.375rem;
            font-size: 1rem;
            cursor: pointer;
            outline: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='white'%3E%3Cpath fill-rule='evenodd' d='M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z' clip-rule='evenodd'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 0.5rem center;
            background-size: 1em;
            padding-right: 2em;
            font-family: 'Saira', sans-serif;
            transition: all 0.2s ease-in-out;
        }

        #ssd-select:focus,
        #psu-select:focus,
        #gpu-select:focus {
            border-color: #95ef81;
            box-shadow: 0 0 5px rgba(66, 210, 50, 0.4);
            background-color: #107c10;
        }

        #component-list select {
            color: #95ef81;
            font-weight: bold;
            text-shadow: 0 0 3px rgba(149, 239, 129, 0.3);
        }

        /* Dolar Popup Specific Styling */
        #dolar-popup {
            z-index: 1000 !important;
        }

        #popup-content {
            width: 300px;
        }

        #load-more-overlay {
            position: absolute;
        }

        #dolar-rates-list .dolar-rate-item {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 0.5rem;
        }

        #dolar-rates-list .dolar-rate-item .dolar-name {
            font-weight: bold;
            color: #e5e7eb;
            margin-bottom: 0.5rem;
        }

        #dolar-rates-list .dolar-rate-item .text-right {
            text-align: right;
            align-self: flex-end;
        }

        @keyframes price-glow-slow {

            0%,
            100% {
                text-shadow: 2px 2px 30px rgba(0, 0, 0, 0.5), 0 0 10px rgba(118, 18, 143, 0.5), 0 0 30px rgba(34, 211, 238, 0.1), 0 0 15px rgba(34, 211, 238, 0.1);
            }

            50% {
                text-shadow: 2px 2px 30px rgba(0, 0, 0, 0.5), 0 0 6px rgba(34, 211, 238, 0.2), 0 0 15px rgba(34, 211, 238, 0.1);
            }
        }

        /* Universal section card style */
        .section-card-style {
            background-color: rgba(31, 41, 55, 0.9);
            border: 1px solid rgba(75, 85, 99, 0.5);
            border-radius: 0.75rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(4px);
            -webkit-backdrop-filter: blur(4px);
            padding: 2.5rem 1rem;
        }

        /* Component List Custom Styles */
        #component-list {
            display: flex;
            flex-direction: column;
            justify-content: space-around;
            height: 100%;
        }

        #component-list li {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            gap: 0.5rem;
            width: 100%;
            margin-bottom: 2rem;
        }

        #component-list li.gpu-integrated-mobile {
            margin-bottom: 0.5rem;
        }

        @media (min-width: 768px) {
            #component-list li {
                flex-direction: row;
                align-items: center;
                gap: 1.5rem;
                margin-bottom: 0;
            }
        }

        #component-list li .component-content-wrapper {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            width: 100%;
            text-align: left;
        }

        @media (min-width: 768px) {
            #component-list li .component-content-wrapper {
                width: auto;
            }
        }

        #component-list li strong {
            font-size: 1.125rem;
            font-weight: 600;
            color: #e5e7eb;
            margin-bottom: 0.25rem;
        }

        #component-list select {
            width: 100%;
            max-width: 250px;
            margin-top: 0;
        }

        #component-list .description-text {
            font-family: 'Inter', sans-serif;
            color: #42d232;
            font-size: 1rem;
            margin-top: 0.25rem;
            min-height: 4.5rem;
            line-height: 1.5;
            padding-left: 0.5rem;
        }

        /* CSS-based image transition for loading */
        .component-option-image,
        #current-tower-image {
            transition: filter 0.4s ease-in-out, opacity 0.4s ease-in-out;
        }

        .component-option-image.loading,
        #current-tower-image.loading {
            filter: grayscale(100%);
            opacity: 0.8;
        }

        #component-list .component-option-image {
            width: 100%;
            max-width: 20rem;
            object-fit: contain;
            flex-shrink: 0;
            margin-top: 0;
            cursor: pointer;
        }

        @media (min-width: 768px) {
            #component-list .component-option-image {
                width: 180px;
                max-width: none;
                left: 6rem;
                position: relative;
            }
        }

        @media (min-width: 768px) {
            #current-tower-image:hover {
                transform: scale(1);
                transform-origin: center center;
            }

            #gpu-image,
            #psu-image {
                transform: scale(1.5);
                transform-origin: right center;
            }

            #ssd-image {
                transform: scale(1);
            }

            #ssd-image:hover {
                transform: scale(1);
            }
        }

        /* Mobile Sticky Price Summary Specific Styles */
        #mobile-price-summary-card {
            padding: 0.75rem 1.5rem;
            justify-content: center;
            align-items: center;
            position: fixed;
            font-weight: 600;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            gap: 0rem;
            box-shadow: 0 -4px 15px rgba(0, 0, 0, 0.4);
            opacity: 0;
            width: fit-content;
            visibility: hidden;
            text-shadow: 2px 2px 3px black;
            transition: opacity 0.5s ease-in-out, visibility 0.5s ease-in-out;
        }

        #mobile-price-summary-card a {
            text-decoration: none;
        }

        #mobile-price-summary-card.show-mobile-price {
            opacity: 1;
            visibility: visible;
        }

        #mobile-price-summary-card .price-section {
            flex-direction: row;
            align-items: baseline;
            font-family: 'Saira', sans-serif;
        }

        #mobile-price-summary-card .currency-value {
            font-size: 3rem;
            line-height: 1;
        }

        #mobile-price-summary-card .currency-text {
            font-size: 1.125rem;
            font-weight: bold;
            line-height: 1;
            margin-left: 0.25rem;
            white-space: nowrap;
        }

        #mobile-price-summary-card .separator {
            width: 1px;
            height: 2.5rem;
            background-color: rgba(75, 85, 99, 0.5);
        }

        #mobile-price-summary-card #usd-link-summary-mobile {
            align-self: left;
        }

        #garantia-section {
            font-size: 1.18rem;
        }

        .coneste {
            text-shadow: black 2px 2px 1px;
        }

        .coneste b {
            color: #42d232;
        }

        /* --- NEW Summary & Peripheral Card Styles --- */
        .peripheral-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }

        .summary-card {
            background-color: white;
            color: #1f2937;
            border-radius: 0.5rem;
            width: 240px;
            height: 190px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            position: relative;
            overflow: hidden;
        }

        .summary-card-category {
            position: absolute;
            top: -1.5rem;
            /* Positioned outside */
            left: 0;
            width: 100%;
            background-color: #4f46e5;
            color: white;
            padding: 0.125rem 0.5rem;
            font-size: 0.75rem;
            font-weight: bold;
            border-top-left-radius: 0.5rem;
            border-top-right-radius: 0.5rem;
            z-index: 2;
            transition: opacity 0.3s ease-out, transform 0.3s ease-out;
            text-align: center;
        }

        #peripherals-grid .peripheral-container.selected .summary-card-category {
            opacity: 1;
            transform: translateY(1.5rem);
        }

        #peripherals-grid .peripheral-container:not(.selected) .summary-card-category {
            opacity: 0;
            transform: translateY(0);
        }

        #selected-components-preview .summary-card-category {
            top: 0;
        }

        .summary-card-image-wrapper {
            width: 100%;
            height: 100%;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            overflow: hidden;
        }

        .summary-card img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: opacity 0.3s ease-in-out, filter 0.3s ease-in-out;
        }

        .peripheral-info {
            text-align: center;
            width: 100%;
            min-height: 60px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .peripheral-info .peripheral-name {
            font-size: 0.875rem;
            font-weight: 600;
            line-height: 1.2;
            color: white;
        }

        .summary-card.unselected .summary-card-image-wrapper img {
            opacity: 0.4;
            filter: grayscale(1);
        }

        .summary-card.unselected .summary-card-image-wrapper::after {
            font-family: "Font Awesome 6 Free";
            content: '\f067';
            /* fa-plus */
            font-weight: 900;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 4rem;
            color: #42d232;
            /* green-333 */
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
            z-index: 1;
        }

        .price-card-subtitle {
            font-family: 'Saira', sans-serif;
            color: #9ca3af;
            font-size: 0.875rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-top: -0.25rem;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        }

        .base-level-container {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .base-level-label {
            font-family: 'Saira', sans-serif;
            font-weight: 700;
            color: #9ca3af;
            margin-bottom: 0.5rem;
            text-transform: uppercase;
        }

        .base-level-tabs {
            display: flex;
            background-color: rgba(17, 24, 39, 0.5);
            border-radius: 0.5rem;
            padding: 0.25rem;
            position: relative;
        }

        #base-level-slider {
            position: absolute;
            top: 0.25rem;
            bottom: 0.25rem;
            background-color: #42d232;
            /* green-333 */
            border-radius: 0.375rem;
            box-shadow: 0 0 10px rgba(66, 210, 50, 0.5);
            transition: all 1s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 0;
        }

        .base-level-tab {
            padding: 0.5rem 1.5rem;
            font-family: 'Saira', sans-serif;
            font-weight: 700;
            font-size: 1.125rem;
            color: #9ca3af;
            /* gray-400 */
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 0.375rem;
            border: 2px solid transparent;
            position: relative;
            z-index: 1;
        }

        .base-level-tab.active {
            color: #111827;
            /* gray-900 */
            text-shadow: none;
        }

        #base-image-container {
            position: relative;
            width: 100%;
            max-width: 400px;
            aspect-ratio: 1/1;
            margin: auto;
        }

        #base-image-container img {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: contain;
            transition: opacity 0.3s ease-in-out;
        }

        .accordion-header {
            cursor: pointer;
            padding: 1rem;
            background-color: rgba(55, 65, 81, 0.5);
            border-radius: 0.5rem;
            margin-top: 1rem;
            transition: background-color 0.3s ease;
        }

        .accordion-header:hover {
            background-color: rgba(75, 85, 99, 0.7);
        }

        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-out;
            padding: 0 1rem;
        }

        .accordion-content.open {
            max-height: 1000px;
            padding: 1rem;
        }

        /* --- NEW AI Section Styles --- */
        #ai-section {
            /* Using styles from Manual de Marca */
            background-color: rgba(31, 41, 55, 0.9);
            /* .section-card-style bg */
            border: 1px solid rgba(75, 85, 99, 0.5);
            /* .section-card-style border */
            border-radius: 0.75rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(4px);
            -webkit-backdrop-filter: blur(4px);
            padding: 2.5rem 1.5rem;
            margin-top: 3rem;
        }

        #ai-input {
            background-color: #111827;
            border: 2px solid #374151;
            color: #e5e7eb;
            font-family: 'Inter', sans-serif;
            transition: border-color 0.3s, box-shadow 0.3s;
        }

        #ai-input:focus {
            outline: none;
            border-color: #6366f1;
            /* Gradiente Principal */
            box-shadow: 0 0 10px rgba(99, 102, 241, 0.5);
        }

        #ai-button {
            background: linear-gradient(to right, #6366f1, #a855f7);
            /* Gradiente Principal */
            font-family: 'Saira', sans-serif;
            font-weight: 700;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        #ai-button:hover {
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(168, 85, 247, 0.5);
        }

        #ai-button:disabled {
            background: #4b5563;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        #ai-result-container {
            background-color: rgba(17, 24, 39, 0.7);
            border: 1px solid #374151;
            min-height: 150px;
        }

        /* Loading spinner animation */
        .loader {
            border: 4px solid #374151;
            border-top: 4px solid #6366f1;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }


        .component-link {
            color: var(--color-link) !important;
            text-decoration: none;
            font-size: 1rem !important;
            font-family: 'Inter' !important;
            display: inline-block;
            margin-top: 4px;
        }

        .component-link:hover {
            text-decoration: underline;
        }

        .component-link i {
            margin-left: 0.25rem;
            font-size: 0.75rem;
        }
    </style>
</head>

<body class="bg-gray-900 text-white">

    <div id="dolar-popup"
        class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4">
        <div id="popup-content"
            class="bg-gray-800/80 backdrop-blur-lg border border-gray-600/50 rounded-xl p-6 w-full max-w_sm text-white flex flex-col items-center justify-center">
            <h3 class="text-xl font-saira font-bold text-center mb-4 text-cyan-300">Cotizaciones Dólar</h3>
            <div id="dolar-rates-list" class="space-y-3">
            </div>
            <hr class="border-gray-600 my-4">
            <a id="google-link" href="#" target="_blank"
                class="block text-center text-sm text-indigo-400 hover:underline">Googlear &rarr;</a>
        </div>
    </div>


    <div id="error-toast"
        class="bg-red-600 text-white text-base rounded-lg p-4 shadow-2xl flex flex-col items-center gap-2">
        <span id="error-toast-message"></span>
        <button id="reset-selection-btn"
            class="hidden bg-white text-red-600 font-bold py-1 px-3 rounded-md text-sm">Reiniciar Selección</button>
    </div>

    <div class="container main-container mx-auto p-4 md:p-8 max-w-5xl">
        <div id="hero-wrapper" class="relative">
            <div id="hero-background" style="left: -1px; top: 66vh;pointer-events:none;">
                <div id="hero-background-in" style="pointer-events:none;left: 4px; top: -2px;"></div>
            </div>

            <img src="home-crox-A.png" id="home-crox-a" class="hero-crox-img" alt="Gabinete PC Gamer Básico"
                onerror="this.onerror=null;this.src='https://placehold.co/400x600/00000000/ffffff?text=PC+Case'">
            <img src="home-crox-B.png" id="home-crox-b" class="hero-crox-img" alt="Gabinete PC Gamer con Periféricos"
                onerror="this.onerror=null;this.src='https://placehold.co/400x600/00000000/ffffff?text=PC+Bundle'">

            <header class="text-center pt-8 relative">
                <img id="ovniUp" src="ovni1fade.png" class="w-32 h-auto" alt="OVNI"
                    onerror="this.onerror=null;this.src='https://placehold.co/128x128/00000000/ffffff?text=OVNI'">
                <img src="LaNave_LogoLetras.png" alt="Logo de La Nave del Medio" class="w-96 h-auto mx-auto mb-4"
                    onerror="this.onerror=null;this.src='https://placehold.co/192x64/00000000/ffffff?text=Logo'">
                <p class="font-vt323 text-6xl green-333 mt-2 tracking-wider" style="text-shadow: 0 0 8px #42d232;">
                    Gamer/Creator </p>
                <p class="green-333 text-2xl font-saira">Tu PC de Gama Media a Medida</small></p>

                <div class="flex items-center justify-center mt-6">
                    <div class="price-container relative hidden">
                        <div class="launch-badge">JUGÁ & CREÁ con Calidá!!</div>
                        <p class="text-5xl font-bold text-cyan-400 price-highlight font-saira" id="top-total-price">
                            $555.000</p>
                        <div class="mt-1 flex items-baseline justify-center gap-2">
                            <span id="usd-price-display-top"
                                class="hidden font-saira text-violet-500 text-2xl cursor-pointer"></span>
                            <a id="usd-link-top" href="#" class="text-gray-500 text-xs hover:underline hidden">¿cuánto
                                está?</a>
                        </div>
                    </div>
                    <img src="smile-messi.gif" alt="Meme de Messi sonriendo"
                        class="w-24 h-auto -ml-8 z-10 md:w-32 md:ml-4 hidden"
                        onerror="this.onerror=null;this.src='https://placehold.co/128x128/00000000/ffffff?text=Meme'">
                </div>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 ">
                    <div class="feature-card">
                        <img src="HardSelect.png" alt="Icono de Hardware Seleccionado" class="w-24 h-24 mb-3"
                            onerror="this.onerror=null;this.src='https://placehold.co/96x96/00000000/ffffff?text=Hard'">
                        <h4 class="font-saira font-bold text-white text-xl leading-tight">Hardware Seleccionado</h4>
                        <p class="text-s text-gray-300 mt-1">Equilibrando Precio/Calidad </p>
                    </div>

                    <div class="feature-card">
                        <img src="SoftInstalled.png" alt="Icono de Software Instalado" class="w-24 h-24 mb-3"
                            onerror="this.onerror=null;this.src='https://placehold.co/96x96/00000000/ffffff?text=Soft'">
                        <h4 class="font-saira font-bold text-white text-xl leading-tight">Programas Clave</h4>
                        <p class="text-s text-gray-300 mt-1">
                            Instalados para <br><b class="text-green-200">PRENDER</b>
                            <span id="dynamic-word"
                                class="transition-all duration-700 ease-in-out font-bold text-green-333">USAR</span>
                        </p>
                        <script>
                            const words = ["USAR", "JUGAR", "CREAR", "VOLAR"];
                            let current = 0;
                            const el = document.getElementById("dynamic-word");
                            const maxLen = Math.max(...words.map(w => w.length));
                            el.style.width = `${maxLen}ch`;
                            el.style.display = "inline-block";
                            el.style.textAlign = "center";
                            setInterval(() => {
                                el.style.opacity = "0.2";
                                setTimeout(() => {
                                    current = (current + 1) % words.length;
                                    el.textContent = words[current];
                                    el.style.opacity = "1";
                                }, 350);
                            }, 2300);
                        </script>
                        <style>
                            #dynamic-word {
                                transition: opacity 0.7s cubic-bezier(.4, 0, .2, 1);
                                opacity: 1;
                                color: #42d232;
                                width: 5ch;
                                display: inline-block;
                                text-align: center;
                            }
                        </style>
                    </div>

                    <div class="feature-card">
                        <img src="WinUpRound.png" alt="Logo de Windows 11" class="w-24 h-24 mb-3"
                            onerror="this.onerror=null;this.src='https://placehold.co/96x96/00000000/ffffff?text=Win11'">
                        <h4 class="font-saira font-bold text-white text-xl leading-tight">Windows 11 Optimizado</h4>
                        <p class="text-s text-gray-300 mt-1">Lo llamo <b class="text-white">WindOS</b>
                        <p class="text-xs text-gray-500">FLUYE COMO EL VIENTO ;)</p>
                        </p>
                    </div>



                    <div class="feature-card animated-bg-games">
                        <div class="corner-ribbon-wrapper">
                            <div class="corner-ribbon"><span class="corner-ribbon-text">OFERTA</span><br><span
                                    class="despegue-text text-violet-700">DESPEGUE</span></div>
                        </div>
                        <div class="text-orange-400 text-4xl mb-3"><i class="fas fa-gift"></i></div>
                        <h4 class="font-saira font-bold text-white text-xl leading-tight">Hasta <p
                                class="text-orange-400 text-xl">3 Juegos Incluidos</p>
                        </h4>
                        <p class="text-s text-gray-300 mt-1">✔ Elegilos</p>
                    </div>
                </div>

            </header>

            <div class="hook-section text-center max-w-4xl mx-auto mt-8 space-y-6 relative z-40">
                <div>

                    <div class="mt-2 text-base text-gray-200 flex items-center justify-center gap-4">

                        <p><i class="fas fa-house-circle-check"></i> Entrega a Domicilio</p>
                        <p> </i><i class="fas fa-screwdriver-wrench"></i> Asistencia Técnica</p>
                        <p>en Toda <i class="text-blue-300">🌊La Costa</i></p>
                    </div>
                    <h2 class="relative z-40 font-saira font-bold text-center mt-16 text-4xl lg:text-5xl "
                        style="color: #FFD700; text-shadow: 0 2px 12px #000a; letter-spacing: 1px;">¡ARMÁ TU NAVE!</h2>
                    <h1 class="text-2xl">con las Mejores Opciones en Mercado Libre con sus links <span class="links"
                            style="color: var(--color-link);"><i class="fas fa-external-link-alt text-sm "></i> </span>
                        para ver sus
                        detalles</h1>
                    <h1>Si sabés del tema, usalos para comprar y armar por tu cuenta!</h1>
                    <p class=" mb-8 text-3xl text-yellow-300">▼</p>
                </div>


            </div>
        </div>

        <div id="price-card-visibility-zone">
            <section id="section-bases" class="my-16 -mt-4 text-center max-w-4xl mx-auto px-4 section-card-style">
                <div class="base-level-container">
                    <span class="base-level-label">NIVEL DE BASE</span>
                    <div id="base-level-selector" class="base-level-tabs">
                        <div id="base-level-slider"></div>
                        <div class="base-level-tab" data-level="0">I</div>
                        <div class="base-level-tab active" data-level="1">II</div>
                        <div class="base-level-tab" data-level="2">III</div>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-12 items-center gap-x-1 gap-y-6">
                    <div class="md:col-span-5">
                        <div id="base-image-container">
                            <img id="base-image" src="" alt="Componentes Base">
                        </div>
                    </div>
                    <div class="md:col-span-7 text-center md:text-left">
                        <p id="base-cpu-text" class="font-saira text-4xl md:text-5xl green-333 coneste"></p>
                        <p id="base-ram-text" class="font-saira text-2xl md:text-4xl green-333 mt-2 coneste"></p>
                        <p id="base-motherboard-text" class="font-saira text-2xl md:text-3xl green-333 coneste"></p>
                        <p id="base-description-text" class="text-lg md:text-xl text-green-200 mt-2 coneste"></p>
                    </div>
                </div>
            </section>

            <!-- <h2 class="relative z-40 font-saira font-bold text-center my-8 text-4xl md:text-2xl lg:text-5xl">
                <span style="color: #FFD700; text-shadow: 0 2px 12px #000a; letter-spacing: 1px;">
                    <span style="color:rgba(66, 210, 50, 0.7);">▼</span> COMPONENTES <span
                        style="color:rgba(66, 210, 50, 0.7);">▼</span>
                </span>
            </h2> -->


            <div id="main-components-container" class="max-w-5xl mx-auto p-6 md:p-8 mb-12 relative section-card-style">
                <section id="component-section" class="flex flex-col md:flex-row items-center gap-x-8 gap-y-6 h-full">
                    <div class="w-full md:w-1/2 flex-shrink-0 h-full flex flex-col items-center justify-center">
                        <div id="tower-selector-container"
                            class="relative w-full rounded-xl shadow-lg overflow-visible flex flex-col items-center h-full">
                            <div class="flex-grow flex items-center justify-center w-full h-full relative">
                                <img id="current-tower-image" src="" alt="Torre PC Gamer"
                                    class="w-full h-full object-contain"
                                    onerror="this.onerror=null;this.src='https://placehold.co/400x500/1f2937/ffffff?text=Torre+PC'">
                            </div>

                            <div id="tower-name-and-arrows-wrapper"
                                class="relative z-10 w-full flex justify-between items-center py-2 px-4">
                                <i id="prev-tower" class="fas fa-chevron-left tower-nav-arrow"></i>
                                <span id="current-tower-name" class="bg-gray-800/80 px-2 py-1 rounded"></span>
                                <i id="next-tower" class="fas fa-chevron-right tower-nav-arrow"></i>
                            </div>
                        </div>
                        <p id="current-tower-price-display" class="text-center  text-lg text-gray-300"></p>
                    </div>
                    <div class="w-full md:w-1/2 h-full flex flex-col justify-around">
                        <ul id="component-list" class="space-y-4 text-gray-300 h-full flex flex-col justify-around">
                            <li id="gpu-li"
                                class="flex flex-col md:flex-row items-center md:items-start w-full gap-4 md:gap-6">
                                <div class="component-content-wrapper text-left md:text-left">
                                    <strong class="text-lg font-semibold">Gráfica:</strong>
                                    <select id="gpu-select" class="ml-0 w-full max-w-[250px]"></select>
                                    <p id="gpu-description" class="description-text"></p>
                                </div>
                                <img id="gpu-image" src="" alt="Tarjeta Gráfica"
                                    class="component-option-image w-full max-w-xs mx-auto md:w-48 md:max-w-none md:mx-0">
                            </li>
                            <li class="flex flex-col md:flex-row items-center md:items-start w-full gap-4 md:gap-6">
                                <div class="component-content-wrapper text-left md:text-left">
                                    <strong class="text-lg font-semibold">Almacenamiento:</strong>
                                    <select id="ssd-select" class="ml-0 w-full max-w-[250px]"></select>
                                    <p id="ssd-description" class="description-text"></p>
                                </div>
                                <img id="ssd-image" src="" alt="Almacenamiento SSD"
                                    class="component-option-image w-full max-w-xs mx-auto md:w-48 md:max-w-none md:mx-0 hidden md:block">
                            </li>
                            <li class="flex flex-col md:flex-row items-center md:items-start w-full gap-4 md:gap-6">
                                <div class="component-content-wrapper text-left md:text-left">
                                    <strong class="text-lg font-semibold">Fuente:</strong>
                                    <select id="psu-select" class="ml-0 w-full max-w-[250px]"></select>
                                    <p id="psu-description" class="description-text"></p>
                                </div>
                                <img id="psu-image" src="" alt="Fuente de Poder"
                                    class="component-option-image w-full max-w-xs mx-auto md:w-48 md:max-w-none md:mx-0">
                            </li>
                        </ul>
                    </div>
                </section>
            </div>

            <!-- ================== NEW AI SECTION START ================== -->
            <section id="ai-section" class="max-w-5xl mx-auto">
                <div class="text-center">
                    <h2 class="font-saira-black text-4xl md:text-5xl brand-gradient-text mb-2">Análisis de Rendimiento
                        por IA</h2>
                    <p class="font-vt323 text-4xl green-333 mb0 mb-6">¿Cómo correrá tu juego favorito en esta Nave?</p>
                </div>
                <div class="max-w-2xl mx-auto">
                    <div class="flex flex-col sm:flex-row items-center gap-4">
                        <input type="text" id="ai-input" class="w-full px-4 py-3 rounded-lg text-lg"
                            placeholder="Escribí el nombre de un juego, ej: Fortnite">
                        <button id="ai-button"
                            class="w-full sm:w-auto px-6 py-3 rounded-lg text-white text-lg flex items-center justify-center gap-2">
                            <i class="fas fa-rocket"></i>
                            <span>Analizar</span>
                        </button>
                    </div>
                    <div id="ai-result-container" class="mt-6 p-6 rounded-lg text-lg text-gray-300">
                        <p id="ai-placeholder" class="text-center text-gray-500">El análisis de la IA aparecerá aquí...
                        </p>
                        <div id="ai-loader" class="hidden mx-auto loader"></div>
                        <div id="ai-result" class="prose prose-invert max-w-none"></div>
                    </div>
                </div>
            </section>
            <!-- ================== NEW AI SECTION END ================== -->


            <h2 class="relative z-40 font-saira font-bold text-center my-8 text-4xl md:text-2xl lg:text-5xl">
                <span style="color: #FFD700; text-shadow: 0 2px 12px #000a; letter-spacing: 1px;">
                    <span style="color:rgba(66, 210, 50, 0.7);">▼</span> PERIFÉRICOS <span
                        style="color:rgba(66, 210, 50, 0.7);">▼</span>
                </span>
            </h2>

            <section id="section-peripherals" class="mb-12 section-card-style px-4">
                <div id="peripherals-grid"
                    class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-y-8 gap-x-4 justify-items-center">
                    <!-- Las tarjetas de periféricos se insertarán aquí con JS -->
                </div>
            </section>

            <div id="section-front-features" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 px-4 md:px-0">
                <div class="feature-card relative lg:col-span-2 soporte-tecnico-card"
                    style="padding: 1rem; overflow: hidden; min-height: 200px;">
                    <img src="memde_think.png" alt="Soporte técnico personalizado"
                        class="absolute -z-10 bottom-0 right-0 h-4/5 w-auto opacity-30 pointer-events-none" md:z-10
                        md:opacity-100 md:h-[110%] md:-right-4"
                        onerror="this.onerror=null;this.src='https://placehold.co/240x264/00000000/ffffff?text=Yo'">

                    <div class="relative z-10 w-full h-full flex flex-col justify-start items-start text-left">
                        <div class="flex items-center gap-4 mb-2 mt-1 sm:mb-3 sm:mt-0">
                            <img src="SoportePersonal.png" alt="Icono de Soporte Técnico"
                                class="w-20 h-20 sm:w-16 sm:h-16 md:w-20 md:h-20 flex-shrink-0"
                                onerror="this.onerror=null;this.src='https://placehold.co/96x96/00000000/ffffff?text=Soporte'">
                            <h4
                                class="font-saira font-bold text-white text-2xl leading-tight whitespace-nowrap mt-1 sm:mt-0">
                                Soporte Técnico</h4>
                        </div>
                        <div class="space-y-1 text-gray-300 max-w-xs pl-0">
                            <p class="flex items-center justify-start"><i
                                    class="fas fa-comments blueish fa-fw w-6"></i><span class="ml-2">Contacto Directo
                                    con @DuendeKenna</span>
                            </p>
                            <p class="flex items-center justify-start"><i
                                    class="fas fa-desktop blueish fa-fw w-6"></i><span class="ml-2">Asistencia Remota
                                    via Web</span></p>
                            <div class="flex items-center justify-start">
                                <i class="fas fa-screwdriver blueish fa-fw w-6"></i>
                                <div class="ml-2">
                                    <p>Servicio a Domicilio</p>
                                    <p class=" text-gray-400 -mt-1">en todo el Partido de La Costa</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="hidden md:flex lg:hidden items-center justify-center">
                    <div
                        class="special-subtitle inline-block text-lg px-6 py-3 transition duration-300 transform hover:scale-105">
                        <div class="flex items-center justify-center gap-5">
                            <i class="fas fa-tasks text-2xl"></i>
                            <div class="text-left">
                                <span class="block leading-tight">Usá esta Web Interactiva</span>
                                <span class="block text-2sm font-sans -mt-2">para simular tu pedido</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <section id="garantia-section" class="mb-12 section-card-style garantia-lista">
                <h2 class="text-3xl font-bold text-center mb-8">Condiciones y Garantía</h2>
                <div class="max-w-3xl mx-auto p-6 md:p-8 space-y-6">
                    <ul class="space-y-4 text-gray-300">
                        <li class="flex items-start gap-3"><i
                                class="fas fa-star green-333 mt-1"></i><span><strong>Componentes Nuevos:</strong> Con
                                garantía de proveedores de confianza.</span></li>
                        <li class="flex items-start gap-3"><i
                                class="fas fa-recycle text-cyan-400 mt-1"></i><span><strong>Componentes Usados:</strong>
                                Podemos <i>reciclar</i> los tuyos para abaratar el precio.</span></li>
                        <li class="flex items-start gap-3"><i
                                class="fas fa-shield-alt text-yellow-400 mt-1"></i><span><strong>Garantía
                                    Total:</strong> 12
                                meses de garantía en todos los componentes.</span></li>
                    </ul>
                    <div class="neon-green-highlight p-4 rounded-lg flex items-center justify-center gap-3 text-center">
                        <i class="fas fa-headset text-2xl"></i>
                        <span class="text-xl font-bold text-gray-200">Servicio Postventa | </span>
                        <span class="font-gamer text-xs">¿Algún Problema?<br>¡Lo Arreglo!</span>
                    </div>
                </div>
            </section>
        </div>


        <form id="orderForm">
            <section id="games-section" class="mb-12 section-card-style hidden">
                <h2 class="text-3xl font-bold text-center mb-8">Juegazos que Viajan👌</h2>
                <p class="text-center green-333 -mt-4 mb-4 font-gamer">👇Seleccioná hasta 3</p>
                <p class="text-center text-violet-600 -mt-4 mb-8 font-gamer">Van Instalados!💾</p>
                <div id="game-grid-container" class="px-4 pt-4">
                    <div id="game-grid-wrapper">
                        <div id="game-list"
                            class="pt-2 pb-2 grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-6">
                        </div>
                    </div>
                    <div id="load-more-overlay" style="pointer-events:auto;"></div>
                </div>
                <div class="text-center load-more-container">
                    <button type="button" id="load-more-games" class="load-more-button font-gamer text-lg">Ver
                        Más</button>
                </div>
                <p id="no-more-games" class="text-gray-500 text-center mt-2 mb-4 hidden">¿No viste el que querés?
                    Pedimelo en Notas?
                </p>
            </section>

            <section id="section-software" class="mb-12 section-card-style">
                <h2 class="text-5xl font-bold text-center mb-8">Programas Clave</h2>
                <p class="text-center font-saira text-xl mb-1">Te marco lo que Recomiendo👍</p>
                <p class="text-center text-gray-100 mb-1 text-xl">✅¡Hacé TU Selección!</p>
                <p class="text-center text-gray-400 mb-6">Podés modificarla luego...</p>
                <div id="software-list" class="max-w-2xl mx-auto space-y-4">
                </div>
                <p class="text-center text-gray-400 mt-6">¿Falta el tuyo? Pedimelo en Notas?</p>
            </section>

            <section class="mb-12 section-card-style">
                <div class="text-center max-w-4xl mx-auto">
                    <div id="selected-games-section" class="mb-6 hidden">
                        <p class="text-gray-400 text-lg">Juegos Incluidos</p>
                        <div id="selected-games-list" class="flex justify-center flex-wrap gap-2 mt-2">
                        </div>
                    </div>

                    <div class="flex flex-col items-center">
                        <h2 class="text-4xl font-bold mb-2">Selección y Precio Total</h2>
                        <p id="base-summary-text" class="font-saira text-2xl  green-333 coneste"></p>
                        <p id="base-price-text" class="font-saira .component-link text-lg"></p>
                        <div id="selected-components-preview" class="w-full p-4 my-6">
                            <!-- Summary content will be inserted here by JS -->
                        </div>

                        <div class="w-full max-w-lg mt-4 flex flex-col items-center">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-y-2 md:gap-x-4 w-full">
                                <div class="md:col-span-2 flex justify-center items-center">
                                    <p class="lucas-price text-center font-saira"><span id="total-price">$500.000</span>
                                    </p>
                                </div>
                                <div class="md:col-span-2 flex justify-center items-center text-center">
                                    <div>
                                        <p class=" green-333 whitespace-nowrap"><i class="fas fa-truck mr-1"></i>Entrega
                                            Personal a Domicilio</p>
                                        <p class="text-xl text-white font-bold">en Toda <strong class="text-white">La
                                                Costa 🌊</strong></p>
                                    </div>
                                </div>
                            </div>
                            <p class="text-gray-400 text-sm mt-4"><i class="fas fa-credit-card"></i> Consultar opciones
                                en cuotas x MP</p>
                        </div>
                    </div>
                </div>
            </section>
            <br><br>

            <section id="notes-section" class="mb-12 text-center section-card-style">
                <h2 class="text-3xl font-bold text-center mb-8">Notas📝</h2>
                <textarea id="extra-notes"
                    class="w-full max-w-xl mx-auto block bg-gray-800 border border-gray-700 rounded-lg p-4 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition"
                    rows="4"
                    placeholder="🤔¿Dudas?&#10;💾¿Otro Software?&#10;⚙️¿Reutilizar tu Hardware?&#10;Escribilo acá que te leo :)"></textarea>
            </section>

            <div class="text-center">
                <p id="pre-submit-text" class="text-gray-400 mb-7">Enviame tu Pedido/Consulta</br><small>*SIN
                        COMPROMISO*</small></p>
                <div class="flex flex-col items-center">
                    <button id="submit-button" type="submit"
                        class="cta-button text-white font-bold py-4 px-10 rounded-full text-xl flex items-center justify-center gap-4">
                        <i class="fab fa-whatsapp text-4xl"></i>
                        <span>¡Vamos a WhatsApp!</span>
                    </button>
                </div>
                <div id="confirmation-message"
                    class="hidden text-center p-6 bg-gray-900/80 border-2 border-green-333 rounded-2xl max-w-md mx-auto mt-4">
                    <i class="fas fa-check-circle text-5xl green-333 mb-4"></i>
                    <h3 class="text-2xl font-bold text-white mb-2">¡Pedido enviado!</h3>
                    <p class="text-gray-300 font-roboto">Gracias por tu consulta. Te responderemos a la brevedad por
                        WhatsApp.</p>
                </div>
            </div>
        </form>



        <footer class="text-center mt-16 pt-8 border-t border-gray-700">
            <div class="mb-6">
                <img src="logo.png" alt="kenna.inf" class="w-80 mx-auto mb-4"
                    onerror="this.onerror=null;this.src='https://placehold.co/320x80/00000000/ffffff?text=Logo'">
                <a id="service-link" href="https://www.facebook.com/kenna.inf/reviews" target="_blank"
                    class="text-indigo-400 hover:text-indigo-300 transition-colors">
                    <i class="fas fa-star"></i> Clientes Satisfechos<br class="sm:hidden"> con Mi Servicio
                </a>
            </div>
            <p class="text-gray-400 mb-4">Redes Sociales</p>
            <div class="flex justify-center gap-6 text-2xl">
                <a href="https://www.instagram.com/kenna.inf" target="_blank"
                    class="text-gray-400 hover:text-white transition"><i class="fab fa-instagram"></i></a>
                <a href="https://www.facebook.com/kenna.inf" target="_blank"
                    class="text-gray-400 hover:text-white transition"><i class="fab fa-facebook"></i></a>
            </div>
            <img id="memde_pointLeft" src="memde_pointLeft.png" alt=""
                onerror="this.onerror=null;this.src='https://placehold.co/250x300/00000000/ffffff?text=Yo'">
        </footer>

    </div>

    <!-- Fullscreen Overlay for Image Zoom (hidden by default) -->
    <div id="fullscreen-overlay" class="fullscreen-overlay hidden">
        <div class="zoomed-content">
            <img id="zoomed-image" src="" alt="Imagen ampliada del componente">
        </div>
    </div>

    <!-- Sticky Price Summary Card -->
    <div id="price-summary-card" class="font-saira items-center justify-center">
        <div class="flex flex-col items-center">
            <div class="price-section ars-price">
                <div class="price-value-row">
                    <span class="currency-value" id="total-price-summary-ars">$500.000</span>
                </div>
            </div>
            <span class="price-card-subtitle">PRECIO FINAL CON SERVICIO</span>
        </div>
        <div class="separator hidden"></div>
    </div>


    <!-- NEW Mobile Sticky Price Summary -->
    <div id="mobile-price-summary-card"
        class="fixed bottom-0 z-50 section-card-style bg-gray-800/90 flex md:hidden justify-center items-center">
        <div class="flex flex-col items-center">
            <div class="price-section ars-price">
                <div class="price-value-row">
                    <span class="currency-value text-cyan-400 font-saira text-right"
                        id="total-price-summary-ars-mobile">$500.000</span>
                </div>
            </div>
            <span class="price-card-subtitle">PRECIO FINAL CON SERVICIO</span>
        </div>
        <div class="separator w-1 h-8 hidden"></div>
        <div class="price-section usd-price pl-4 hidden" id="usd-price-section-mobile">

            <a id="usd-link-summary-mobile" href="#" class="text-xs text-gray-500 hover:underline">
                <div class="price-value-row">
                    <span class="currency-value text-violet-600 font-saira"><span
                            id="total-price-summary-usd-mobile"></span></span>
                </div>
            </a>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // --- DATA ---
            const gameNames = ['GTA V', 'LoL', 'Dota 2', 'Overwatch 2', 'Minecraft', 'Rocket League', 'Need for Speed: Hot Pursuit Remastered', 'Need for Speed: Underground HD', 'Half Life: Black Mesa', 'Half Life 2 HD', 'Abe´s Oddysey Remake', 'WoW Classic: en TurtleWoW', 'Dishonored 2', 'Borderlands 2', 'Portal 1 y 2', 'Left 4 Dead 2', 'BioShock Remaster', 'BioShock 2 Remaster', 'BioShock Infinite', 'Fallout 3', 'Fallout: New Vegas', 'Batman: Arkham Asylum', 'Batman: Arkham City', 'Sleeping Dogs: Definitive Edition', 'Tomb Raider (2013)', 'Mass Effect Legendary Edition', 'Far Cry 3', 'Deus Ex: Human Revolution', 'Serious Sam Classics: Revolution', 'Burnout Paradise', 'DiRT 3 Complete Edition', 'Need for Speed: Underground 2 HD', 'Need for Speed: Most Wanted HD', 'Blur', 'GRID 2', 'GRID Autosport', 'F1 2014', 'FIFA 17', 'PES 2017', 'NBA 2K17', 'FallGuys', 'Sims 4 + Expansiones', 'Spore: Aventuras Galacticas', 'Roblox', 'Call of Duty: Black Ops', 'Call of Duty: Black Ops 2', 'Metro 2033', 'Crysis 2', 'Bulletstorm', 'Dishonored', 'Max Payne 3', 'Singularity', 'F.E.A.R.', 'Mortal Kombat 11 Komplete Edition', 'Ultra Street Fighter IV', 'Ultimate Marvel vs. Capcom 3', 'The King of Fighters XIII', 'Injustice Gods Among Us', 'Heroes of Might & Magic HD V', 'Reckoning: Kingdoms of Amalur', 'Divinity Original Sin', 'Age of Empires II Definitive Edition', 'The Elder Scrolls V: Skyrim', 'The Elder Scrolls IV: Oblivion & AddOns HD'];
            const softwareData = [
                // SISTEMA
                { name: 'AVG AntiVirus', slug: 'avg_antivirus', checked: true, disabled: false, category: 'Sistema', descripcion: 'Antivirus gratuito y eficaz.' },
                { name: 'Avast AntiVirus', slug: 'avast_antivirus', checked: false, disabled: false, category: 'Sistema', descripcion: 'Igual que AVG pero más molesto.' },
                { name: 'BitDefender', slug: 'bitdefender', checked: false, disabled: false, category: 'Sistema', descripcion: 'Excelente antivirus. Requiere cuenta gratuita.' },
                { name: 'MalwareBytes', slug: 'malwarebytes', checked: true, disabled: false, category: 'Sistema', descripcion: 'Elimina malware y spyware. Complementa antivirus.' },
                { name: 'Firewall App Blocker', slug: 'firewall_app_blcoker', checked: false, disabled: false, category: 'Sistema', descripcion: 'Bloquea el acceso a internet de las aplicaciones elegidas.' },
                { name: 'Fraps', slug: 'fraps', checked: true, disabled: false, category: 'Sistema', descripcion: 'Captura pantalla y FPS. Para tunear juegos es fundamental.' },
                { name: 'HW Monitor', slug: 'hw_monitor', checked: true, disabled: false, category: 'Sistema', descripcion: 'Monitorea temperatura y voltajes.' },
                { name: 'Macrium Reflect', slug: 'macrium_reflect', checked: false, disabled: false, category: 'Sistema', descripcion: 'Clona y respalda discos.' },
                { name: 'Space Sniffer', slug: 'space_sniffer', checked: true, disabled: false, category: 'Sistema', descripcion: 'Visualiza uso de espacio en disco. Ideal para hacer lugar.' },
                { name: 'Uninstall Tool', slug: 'uninstall_tool', checked: true, disabled: false, category: 'Sistema', descripcion: 'Desinstala programas a fondo.' },
                { name: 'Wise Memory Optimizer', slug: 'wise_memory_optimizer', checked: true, disabled: false, category: 'Sistema', descripcion: 'Libera y optimiza la RAM.' },
                { name: 'Wise Registry Cleaner', slug: 'wise_registry_cleaner', checked: false, disabled: false, category: 'Sistema', descripcion: 'Limpia el registro de Windows.' },
                // MULTIMEDIA
                { name: 'Hear', slug: 'hear', checked: false, disabled: false, category: 'Multimedia', descripcion: 'Mejora el audio del sistema. Alta configuración.' },
                { name: 'PotPlayer', slug: 'potplayer', checked: true, disabled: false, category: 'Multimedia', descripcion: 'Reproductor de video avanzado.' },
                { name: 'VLC Player', slug: 'vlc_player', checked: false, disabled: false, category: 'Multimedia', descripcion: 'Reproduce cualquier formato de video.' },
                { name: 'WinAmp', slug: 'winamp', checked: true, disabled: false, category: 'Multimedia', descripcion: 'Clásico reproductor de música, renovado por la comunidad.' },
                { name: 'YouTube', slug: 'youtube', checked: true, disabled: false, category: 'Multimedia', descripcion: 'YouTube *sin publicidad*.' },
                { name: 'Spotify', slug: 'spotify', checked: true, disabled: false, category: 'Multimedia', descripcion: 'Música en streaming.' },
                { name: 'Stremio', slug: 'stremio', checked: true, disabled: false, category: 'Multimedia', descripcion: 'Películas y series online.' },
                // WEB
                { name: 'Brave', slug: 'brave', checked: true, disabled: false, category: 'Web', descripcion: 'Navegador rápido y seguro basado en Chrome. Bloquea publicidad.' },
                { name: 'Opera GX', slug: 'opera_gx', checked: true, disabled: false, category: 'Web', descripcion: 'Navegador gamer personalizable. Bloquea publicidad.' },
                { name: 'Google Chrome', slug: 'google_chrome', checked: true, disabled: false, category: 'Web', descripcion: 'Navegador web popular.' },
                { name: 'WhatsApp', slug: 'whatsapp', checked: true, disabled: false, category: 'Web', descripcion: 'Mensajería instantánea.' },
                { name: 'Discord', slug: 'discord', checked: false, disabled: false, category: 'Web', descripcion: 'Chat de voz y texto para comunidades.' },
                { name: 'Zoom', slug: 'zoom', checked: false, disabled: false, category: 'Web', descripcion: 'Videollamadas y reuniones online.' },
                { name: 'Free Download Manager', slug: 'freedownloadmanager', checked: true, disabled: false, category: 'Web', descripcion: 'Gestor de descargas y torrents eficiente.' },
                { name: 'JDownloader 2', slug: 'jdownloader_2', checked: false, disabled: false, category: 'Web', descripcion: 'Descarga archivos de internet.' },
                { name: 'qBitTorrent', slug: 'qbittorrent', checked: false, disabled: false, category: 'Web', descripcion: 'Descarga archivos de internet.' },
                // CREACIÓN
                { name: 'Inkscape', slug: 'inkscape', checked: false, disabled: false, category: 'Creación', descripcion: 'Gráficos vectoriales. Ideal para diseñar logos profesionales.' },
                { name: 'Krita', slug: 'krita', checked: false, disabled: false, category: 'Creación', descripcion: 'Pintura y arte digital.' },
                { name: 'Photopea', slug: 'photopea', checked: true, disabled: false, category: 'Creación', descripcion: 'Clon de Photoshop online.' },
                { name: 'Canva', slug: 'canva', checked: true, disabled: false, category: 'Creación', descripcion: 'Diseño gráfico fácil.' },
                { name: 'GIMP', slug: 'gimp', checked: false, disabled: false, category: 'Creación', descripcion: 'Editor de imágenes avanzado.' },
                { name: 'XnConvert', slug: 'xnconvert', checked: true, disabled: false, category: 'Creación', descripcion: 'Conversión y mejora de imágenes por lotes.' },
                { name: 'CapCut', slug: 'capcut', checked: false, disabled: false, category: 'Creación', descripcion: 'Edición de video sencilla.' },
                { name: 'DaVinci Resolve', slug: 'davinci_resolve', checked: true, disabled: false, category: 'Creación', descripcion: 'Edición de video profesional.' },
                { name: 'OBS Studio', slug: 'obs_studio', checked: true, disabled: false, category: 'Creación', descripcion: 'Grabación y streaming.' },
                { name: 'GitHub Desktop', slug: 'github_desktop', checked: false, disabled: false, category: 'Desarrollo', descripcion: 'Cliente visual para Git.' },
                { name: 'Visual Studio Code', slug: 'visual_studio_code', checked: false, disabled: false, category: 'Desarrollo', descripcion: 'Editor de código moderno.' },
            ];
            const toSlug = (str) => str.toLowerCase().replace(/[^\w\s-]/g, '').trim().replace(/[\s_-]+/g, '-').replace(/^-+|-+$/g, '');
            const games = gameNames.map(name => ({ name: name, slug: toSlug(name) }));

            // --- GLOBAL APP STATE ---
            const GAIN_PRICE = 110000;
            let BASE_PRICE = 0;
            let allDolarRates = [];
            let currentTowerIndex = 0;
            let currentBaseLevel = 1; // Default to Nivel II

            // --- NEW: Centralized state for selected component indices ---
            let selectedComponentIndices = {
                gpu: 0,
                ssd: 0,
                psu: 0
            };

            // Component Options
            let baseOptions = [], cpuOptions = [], ramOptions = [], motherboardOptions = [],
                towersOptions = [], ssdOptions = [], gpuOptions = [], psuOptions = [],
                comboMouseTecladoOptions = [], keyboardOptions = [], mouseOptions = [],
                monitorOptions = [], auricularesOptions = [], parlantesOptions = [],
                microfonosOptions = [], webcamOptions = [], arosDeLuzOptions = [], wifiOptions = [];

            // NEW: State for optional peripherals
            const selectedPeripherals = {
                monitor: -1, keyboard: -1, mouse: -1, auriculares: -1,
                parlantes: -1, microfono: -1, webcam: -1, arodeluz: -1, wifi: -1
            };

            // --- INITIALIZE ---
            function initializeApp(data) {
                baseOptions = (data.baseOptions || []).filter(opt => opt.visible !== 0);
                cpuOptions = data.cpuOptions || [];
                ramOptions = data.ramOptions || [];
                motherboardOptions = data.motherboardOptions || [];
                towersOptions = (data.towersOptions || []).filter(opt => opt.visible !== 0);
                ssdOptions = (data.ssdOptions || []).filter(opt => opt.visible !== 0);
                gpuOptions = (data.gpuOptions || []).filter(opt => opt.visible !== 0);
                psuOptions = (data.psuOptions || []).filter(opt => opt.visible !== 0);
                keyboardOptions = (data.keyboardOptions || []).filter(opt => opt.visible !== 0);
                mouseOptions = (data.mouseOptions || []).filter(opt => opt.visible !== 0);
                monitorOptions = (data.monitorOptions || []).filter(opt => opt.visible !== 0);
                auricularesOptions = (data.auricularesOptions || []).filter(opt => opt.visible !== 0);
                parlantesOptions = (data.parlantesOptions || []).filter(opt => opt.visible !== 0);
                microfonosOptions = (data.microfonosOptions || []).filter(opt => opt.visible !== 0);
                webcamOptions = (data.webcamOptions || []).filter(opt => opt.visible !== 0);
                arosDeLuzOptions = (data.arosDeLuzOptions || []).filter(opt => opt.visible !== 0);
                wifiOptions = (data.wifiOptions || []).filter(opt => opt.visible !== 0);

                updateBasePrice();
                fetchDolarRate();
                populateUI();
                setupEventListeners();
                updateAllDisplays();
            }

            fetch('products.json')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    initializeApp(data);
                })
                .catch(error => {
                    console.error('Failed to load products.json, using fallback data:', error);
                    const fallbackData = { "baseOptions": [{ "id": 49735, "name": "Ryzen 5 5600g", "cpu": "896", "ram": "81841", "mother": "49131", "cantRam": 1, "total": 351882, "visible": 1 }, { "id": 30077, "name": "Ryzen 7 5700G ", "cpu": "55990", "ram": "81841", "mother": "49131", "cantRam": 1, "total": 376748, "visible": 1 }, { "id": 45319, "name": "Ryzen 7 5700G ", "cpu": "55990", "mother": "23506", "ram": "93477", "cantRam": 4, "total": 487353, "visible": 1 }], "cpuOptions": [{ "id": "896", "name": "Ryzen 5 5600g", "price": 214534, "description": "6 nucleos 4.4ghz Am4", "image_url": "comps/cpus/ryzen5_5600g.webp", "link": "https://articulo.mercadolibre.com.ar/MLA-933485601-micro-procesador-amd-ryzen-5-5600g-44ghz-am4-radeon-vega-_JM?offer_type=BEST_PRICE", "visible": 1 }, { "id": "55990", "name": "Ryzen 7 5700G ", "price": 239400, "description": "8 nucleos 4.6ghz Am4", "image_url": "comps/cpus/ryzen7_5700g.webp", "link": "https://www.mercadolibre.com.ar/procesador-amd-ryzen-7-5700g-100-100000263box-de-8-nucleos-y-46ghz-de-frecuencia-con-grafica-integrada/p/MLA18441624?offer_type=BEST_PRICE", "visible": 1 }], "ramOptions": [{ "id": "81841", "name": "DDR4 8x2 = 16 GB", "price": 48999, "description": "Descripción de la nueva RAM.", "image_url": "comps/rams/16gb.webp", "link": "https://www.mercadolibre.com.ar/memoria-ram-kingdian-ddr4-16gb-2x8gb-3200mhz-cl22-12v/p/MLA48899665?offer_type=BEST_PRICE", "visible": 1 }, { "id": "93477", "name": "DDR4 8 GB - Hiksemi", "price": 38769, "description": "Descripción de la nueva RAM.", "image_url": "comps/rams/8gb.webp", "link": "https://www.mercadolibre.com.ar/memoria-ram-ddr4-8gb-3200mhz-hiksemi-armor-white-u-dimm/p/MLA39241493?offer_type=BEST_PRICE", "visible": 1 }], "motherboardOptions": [{ "id": "49131", "name": "Asrock B450m-HDV R4.0", "price": 88349, "description": "Placa madre básica para Intel de 10ma Gen. Ideal para setups económicos.", "image_url": "comps/moms/b450m-asrock.png", "link": "https://www.mercadolibre.com.ar/motherboard-asrock-amd-b450m-hdv-r4.0-am4-hdmi-ddr4-color-negro/p/MLA22661333?offer_type=BEST_PRICE", "visible": 1 }, { "id": "23506", "name": "Asrock A520m", "price": 92877, "description": "Descripción de la nueva Motherboard.", "image_url": "comps/moms/asrock_a520m.webp", "link": "https://www.mercadolibre.com.ar/motherboard-asrock-a520m-ryzen-ddr4-hdmi-pcreg-color-negro/p/MLA24527962?offer_type=BEST_PRICE", "visible": 1 }], "towersOptions": [{ "id": 29026, "name": "LNZ Y11", "price": 59999, "slug": "lnz-y11", "image_url": "comps/torres/lnz-y11.webp", "link": "https://www.mercadolibre.com.ar/gabinete-gamer-lnz-y11-frentelateral-templado-y11-sf-argb-color-negro/p/MLA47405234?offer_type=BEST_PRICE", "visible": 1 }, { "id": 50127, "name": "Antec AX20", "price": 61910, "slug": "antec-ax20", "image_url": "comps/torres/antec-ax20.webp", "link": "https://www.mercadolibre.com.ar/gabinete-para-computadora-de-escritorio-antec-ax20-elite-4/p/MLA28594175?offer_type=BEST_PRICE", "visible": 1 }], "ssdOptions": [{ "id": 27876, "name": "500 GB - NVMe", "price": 51895, "description": "Alta velocidad PCIe 3.0, mucho más rápido que un sólido clásico.", "image_url": "comps/discos/nvme_hik_500.webp", "link": "https://www.mercadolibre.com.ar/disco-solido-ssd-512gb-m2-nvme-hiksemi-wave-2500mbs-pcie/p/MLA25591261?offer_type=BEST_PRICE", "visible": 1 }, { "id": 93692, "name": "1 TB - NVMe", "price": 95989, "description": "Ideal si creás contenido además de jugar, o tenés una extensa colección.", "image_url": "comps/discos/nvme_wd_1.webp", "link": "https://www.mercadolibre.com.ar/disco-ssd-1tb-sn350-m2-nvme-green-western-digital/p/MLA24819136?offer_type=BEST_PRICE", "visible": 1 }], "gpuOptions": [{ "id": 67931, "name": "Integrada", "price": 0, "description": "Viene con el CPU - más que suficiente para arrancar.", "image_url": "comps/gpus/vega.webp", "link": "", "visible": 1 }, { "id": 38532, "name": "RX 7600 - 8GB GDDR6", "price": 369999, "description": "Rendimiento moderno para jugar en 1080p y 1440p (según el juego). Arquitectura RDNA 3, eficiencia energética y potencia. Hoy, a un EXCELENTE precio.", "image_url": "comps/gpus/38532.webp", "link": "https://www.mercadolibre.com.ar/tarjeta-de-video-amd-radeon-rx-7600-powercolor-8gb-gddr6/p/MLA29675752?offer_type=BEST_PRICE#polycard_client=search_best-seller&tracking_id=441f348b-7b07-4062-afc1-4ca4eadfdd88&wid=MLA2148656004&sid=search", "visible": 1 }], "psuOptions": [{ "id": 27579, "name": "Certificada Redragon 500W", "price": 70300, "description": "Recomendada para cuidar nuestros componentes.", "image_url": "comps/psus/500redragon.webp", "link": "https://www.mercadolibre.com.ar/fuente-de-alimentacion-para-pc-redragon-rpgs-gc-ps001-500w-negra/p/MLA43937355?offer_type=BEST_PRICE", "visible": 1 }, { "id": 73804, "name": "Certificada Sentey 500W", "price": 89999, "description": "Otra buena opción 80 Plus. 3 Años de Garantía.", "image_url": "comps/psus/550sentey80.webp", "link": "https://www.mercadolibre.com.ar/fuente-pc-gamer-500w-sentey-hbp500-gs-80-plus-bronze-atx-color-negro/p/MLA19715438?offer_type=BEST_PRICE", "visible": 1 }], "comboMouseTecladoOptions": [{ "id": 67546, "name": "Inalámbricos Solarmax", "price": 16297, "image_url": "comps/combos-mouse-teclado/mouse-y-teclado-inalámbricos-solarmax.webp", "visible": 1 }], "keyboardOptions": [{ "id": 15740, "name": "Shiva K512 Cableado", "price": 46075, "image_url": "comps/teclados/shiva-k512-cableado.webp", "visible": 1 }], "mouseOptions": [{ "id": 18066, "name": "Redragon Wireless", "price": 24824, "image_url": "comps/mouses/redragon-wireless.webp", "visible": 1 }], "monitorOptions": [{ "id": 19499, "name": "Cooler Master 24'' 100hz", "price": 166190, "image_url": "comps/monitores/cooler-master-24-100hz.webp", "visible": 1 }], "auricularesOptions": [{ "id": 84174, "name": "Kotion Each Cableado", "price": 48999, "image_url": "comps/auriculares/kotion-each-cableado.webp", "visible": 1 }], "parlantesOptions": [{ "id": 9675, "name": "Genius Madera", "price": 18000, "image_url": "comps/parlantes/genius-madera.webp", "visible": 1 }], "microfonosOptions": [], "webcamOptions": [], "arosDeLuzOptions": [], "wifiOptions": [] };
                    initializeApp(fallbackData);
                });


            function populateUI() {
                // Populate game list
                const gameListContainer = document.getElementById('game-list');
                games.forEach(game => {
                    const imageSrc = `cover/${game.slug}.webp`;
                    const cardEl = document.createElement('div');
                    cardEl.className = 'card-game';
                    cardEl.id = `card-game-${game.slug}`;
                    cardEl.innerHTML = `
                        <input type="checkbox" id="game-${game.slug}" name="game" value="${game.name}" data-img-src="${imageSrc}" class="hidden">
                        <label for="game-${game.slug}" class="rounded-xl cursor-pointer transition">
                            <img src="${imageSrc}" alt="Carátula de ${game.name}" class="rounded-xl w-full h-full object-cover" onerror="this.onerror=null;this.src='https://placehold.co/300x400/111827/4f46e5?text=${game.name.replace(/\s/g, '+')}';">
                            <div class="game-title-sticker hidden">${game.name}</div>
                        </label>`;
                    gameListContainer.appendChild(cardEl);
                });

                // Populate software list
                const softwareCategories = [
                    { name: 'Sistema', description: 'Herramientas para mantener, optimizar y proteger tu PC.', icon: 'fa-shield-alt' },
                    { name: 'Multimedia', description: 'Reproductores, audio y apps para disfrutar de música y video.', icon: 'fa-photo-film' },
                    { name: 'Web', description: 'Navegadores, mensajería y gestores de descargas.', icon: 'fa-globe' },
                    { name: 'Creación', description: 'Edición de imágenes, video, diseño y herramientas para creadores.', icon: 'fa-paint-brush' },
                    { name: 'Desarrollo', description: 'Herramientas para programar, editar código y gestionar proyectos.', icon: 'fa-code' },
                ];
                const softwareListContainer = document.getElementById('software-list');
                softwareListContainer.innerHTML = '';
                softwareCategories.forEach((category, idx) => {
                    const categoryWrapper = document.createElement('div');
                    categoryWrapper.className = 'mb-4 border border-violet-700 rounded-lg overflow-hidden';
                    // Header clickable
                    const header = document.createElement('button');
                    header.type = 'button';
                    header.className = 'w-full flex items-center justify-between px-4 py-3 bg-violet-950 hover:bg-violet-900 transition font-bold text-lg text-violet-400 focus:outline-none';
                    header.innerHTML = `<span class="flex items-center gap-2"><i class="fas ${category.icon} text-violet-300 text-xl"></i> ${category.name}</span><span class="accordion-arrow text-violet-300 transition-transform"><i class="fas fa-chevron-down"></i></span>`;
                    categoryWrapper.appendChild(header);
                    // Descripción
                    const descDiv = document.createElement('div');
                    descDiv.className = 'software-cat-desc px-4 py-2 text-base text-violet-100 bg-[#1a1332]';
                    descDiv.textContent = category.description;
                    categoryWrapper.appendChild(descDiv);
                    // Items (ocultos por defecto)
                    const itemsWrapper = document.createElement('div');
                    itemsWrapper.className = 'grid grid-cols-2 md:grid-cols-3 gap-4 px-4 pb-4 hidden';
                    const programs = softwareData.filter(item => item.category === category.name);
                    programs.forEach(item => {
                        const essentialClass = item.disabled ? 'essential-software' : '';
                        const disabledClass = item.disabled ? 'cursor-not-allowed opacity-60' : 'cursor-pointer';
                        const labelColorClass = item.disabled ? 'green-333' : 'text-white';
                        const softwareItemHTML = document.createElement('div');
                        softwareItemHTML.className = `relative bg-gray-800 p-3 rounded-lg flex items-center ${disabledClass} ${essentialClass}`;
                        const customCheckbox = document.createElement('div');
                        customCheckbox.className = 'custom-software-checkbox';
                        customCheckbox.dataset.slug = item.slug;
                        if (item.checked) {
                            customCheckbox.classList.add('checked');
                        }
                        const span = document.createElement('span');
                        span.className = `ml-3 text-sm font-medium ${labelColorClass}`;
                        span.textContent = item.name;
                        softwareItemHTML.appendChild(customCheckbox);
                        softwareItemHTML.appendChild(span);
                        softwareItemHTML.addEventListener('mouseenter', () => { descDiv.textContent = `${item.name}: ${item.descripcion}`; });
                        softwareItemHTML.addEventListener('mouseleave', () => { descDiv.textContent = category.description; });
                        softwareItemHTML.addEventListener('click', () => {
                            if (!item.disabled) {
                                customCheckbox.classList.toggle('checked');
                            }
                        });
                        itemsWrapper.appendChild(softwareItemHTML);
                    });
                    categoryWrapper.appendChild(itemsWrapper);
                    // Acordeón: solo uno abierto
                    header.addEventListener('click', () => {
                        document.querySelectorAll('#software-list .grid').forEach(el => {
                            if (el !== itemsWrapper) el.classList.add('hidden');
                        });
                        document.querySelectorAll('#software-list .accordion-arrow').forEach(arrow => {
                            arrow.style.transform = '';
                        });
                        if (itemsWrapper.classList.contains('hidden')) {
                            itemsWrapper.classList.remove('hidden');
                            header.querySelector('.accordion-arrow').style.transform = 'rotate(180deg)';
                        } else {
                            itemsWrapper.classList.add('hidden');
                            header.querySelector('.accordion-arrow').style.transform = '';
                        }
                    });
                    softwareListContainer.appendChild(categoryWrapper);
                });

                // --- REFACTORED: Populate component selects using index as value ---
                const ssdSelect = document.getElementById('ssd-select');
                if (ssdSelect) ssdSelect.innerHTML = ssdOptions.map((o, i) => `<option value="${i}">${o.name}</option>`).join('');

                const gpuSelect = document.getElementById('gpu-select');
                if (gpuSelect) gpuSelect.innerHTML = gpuOptions.map((o, i) => `<option value="${i}">${o.name}</option>`).join('');

                const psuSelect = document.getElementById('psu-select');
                if (psuSelect) psuSelect.innerHTML = psuOptions.map((o, i) => `<option value="${i}">${o.name}</option>`).join('');

                populateOptionalPeripherals();
            }

            function setupEventListeners() {
                // Base Level Selector
                document.querySelectorAll('.base-level-tab').forEach(tab => {
                    tab.addEventListener('click', () => {
                        document.querySelectorAll('.base-level-tab').forEach(t => t.classList.remove('active'));
                        tab.classList.add('active');
                        currentBaseLevel = parseInt(tab.dataset.level);
                        updateBaseDisplay();
                        updateBasePrice();
                        updatePrices();
                        updateSliderPosition();
                    });
                });

                // --- REFACTORED: Component Selects event listeners ---
                document.getElementById('gpu-select')?.addEventListener('change', (e) => {
                    selectedComponentIndices.gpu = parseInt(e.target.value);
                    updateComponentDisplay('gpu');
                });
                document.getElementById('ssd-select')?.addEventListener('change', (e) => {
                    selectedComponentIndices.ssd = parseInt(e.target.value);
                    updateComponentDisplay('ssd');
                });
                document.getElementById('psu-select')?.addEventListener('change', (e) => {
                    selectedComponentIndices.psu = parseInt(e.target.value);
                    updateComponentDisplay('psu');
                });

                // Tower navigation
                document.getElementById('prev-tower').addEventListener('click', prevTower);
                document.getElementById('next-tower').addEventListener('click', nextTower);

                // Peripherals Grid Listener
                document.getElementById('peripherals-grid').addEventListener('click', handlePeripheralClick);

                // Summary Section Listener
                document.getElementById('selected-components-preview').addEventListener('click', handleSummaryCardClick);


                // Games
                document.querySelectorAll('input[name="game"]').forEach(checkbox => {
                    checkbox.addEventListener('change', handleGameSelectionChange);
                });
                document.getElementById('load-more-games').addEventListener('click', expandGameGrid);
                document.getElementById('reset-selection-btn').addEventListener('click', resetGameSelection);

                // Form submission
                document.getElementById('orderForm').addEventListener('submit', handleFormSubmit);

                // Dolar Popup
                const dolarTriggers = ['usd-link-top', 'usd-price-display-top', 'usd-link-bottom', 'total-price-usd', 'usd-link-summary', 'total-price-summary-usd', 'usd-link-summary-mobile', 'total-price-summary-usd-mobile'];
                dolarTriggers.forEach(id => document.getElementById(id)?.addEventListener('click', (e) => { e.preventDefault(); showDolarPopup(); }));
                const dolarPopup = document.getElementById('dolar-popup');
                dolarPopup.addEventListener('click', (e) => { if (e.target === dolarPopup) dolarPopup.style.display = 'none'; });

                // Image Zoom
                const fullscreenOverlay = document.getElementById('fullscreen-overlay');
                fullscreenOverlay.addEventListener('click', () => fullscreenOverlay.classList.remove('active'));
                ['current-tower-image', 'gpu-image', 'ssd-image', 'psu-image'].forEach(id => {
                    const imgEl = document.getElementById(id);
                    imgEl?.addEventListener('click', () => {
                        document.getElementById('zoomed-image').src = imgEl.src;
                        fullscreenOverlay.classList.add('active');
                    });
                });

                // Price card visibility observer
                const priceVisibilityZone = document.getElementById('price-card-visibility-zone');
                if (priceVisibilityZone) {
                    const observer = new IntersectionObserver(entries => {
                        const isIntersecting = entries[0].isIntersecting;
                        document.getElementById('mobile-price-summary-card').classList.toggle('show-mobile-price', isIntersecting);
                        document.getElementById('price-summary-card').classList.toggle('visible', isIntersecting);
                    });
                    observer.observe(priceVisibilityZone);
                }

                // Window resize
                window.addEventListener('resize', () => {
                    setInitialGridHeight();
                    positionCroxImages();
                    updateSliderPosition();
                });
                // AI Section Listener
                document.getElementById('ai-button').addEventListener('click', checkGameCompatibility);
                // Permitir Enter en el input para analizar
                document.getElementById('ai-input').addEventListener('keydown', function(e) {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        document.getElementById('ai-button').click();
                    }
                });
            }

            function updateAllDisplays() {
                updateBaseDisplay();
                updateTowerDisplay();
                updateComponentDisplay('gpu');
                updateComponentDisplay('ssd');
                updateComponentDisplay('psu');
                updateSelectedGamesList();
                setInitialGridHeight();
                positionCroxImages();
                updatePrices();
                updateSliderPosition();
            }

            function updateBasePrice() {
                if (baseOptions.length > currentBaseLevel) {
                    BASE_PRICE = baseOptions[currentBaseLevel].total + GAIN_PRICE;
                } else {
                    console.error("Selected base level is out of bounds.");
                    BASE_PRICE = GAIN_PRICE; // Fallback
                }
            }

            // --- PRICE CALCULATION ---
            function updatePrices() {
                let total = BASE_PRICE;

                // --- REFACTORED: Get prices from selected indices ---
                total += gpuOptions[selectedComponentIndices.gpu]?.price || 0;
                total += ssdOptions[selectedComponentIndices.ssd]?.price || 0;
                total += psuOptions[selectedComponentIndices.psu]?.price || 0;
                if (towersOptions.length > 0) total += towersOptions[currentTowerIndex].price;

                // Add prices from selected peripherals
                const peripheralCollections = {
                    monitor: monitorOptions, keyboard: keyboardOptions, mouse: mouseOptions,
                    auriculares: auricularesOptions, parlantes: parlantesOptions, microfono: microfonosOptions,
                    webcam: webcamOptions, arodeluz: arosDeLuzOptions, wifi: wifiOptions
                };

                for (const key in selectedPeripherals) {
                    if (selectedPeripherals[key] > -1) {
                        total += peripheralCollections[key][selectedPeripherals[key]].price;
                    }
                }

                const formattedArs = '$' + total.toLocaleString('es-AR', { minimumFractionDigits: 0, maximumFractionDigits: 0 });
                document.getElementById('total-price').textContent = formattedArs;
                document.getElementById('top-total-price').textContent = formattedArs;
                document.getElementById('total-price-summary-ars').textContent = formattedArs;
                document.getElementById('total-price-summary-ars-mobile').textContent = formattedArs;

                updateSelectedComponentsDisplay();
            }

            async function fetchDolarRate() {
                try {
                    const response = await fetch('https://dolarapi.com/v1/dolares');
                    if (!response.ok) throw new Error('Network response was not ok for Dolar rates');
                    allDolarRates = await response.json();
                } catch (error) {
                    console.error("Could not fetch exchange rate:", error);
                    allDolarRates = [];
                }
            }

            // --- UI UPDATE FUNCTIONS ---
            function updateBaseDisplay() {
                if (typeof baseOptions === 'undefined' || baseOptions.length <= currentBaseLevel) return;
                const base = baseOptions[currentBaseLevel];
                const cpu = cpuOptions && cpuOptions.find(c => String(c.id) === String(base.cpu));
                const ram = ramOptions && ramOptions.find(c => String(c.id) === String(base.ram));
                const motherboard = motherboardOptions && motherboardOptions.find(c => String(c.id) === String(base.mother));

                if (cpu && ram && motherboard) {
                    // CPU
                    const cpuNameParts = cpu.name.split(' ');
                    document.getElementById('base-cpu-text').innerHTML = `<b>${cpuNameParts.slice(0, 2).join(' ')}</b> ${cpuNameParts.slice(2).join(' ')} <a href="${cpu.link}" target="_blank" style="color: var(--color-link); margin-left:8px;"><i class="fas text-sm fa-external-link-alt"></i></a>`;
                    // RAM: solo muestra la cantidad total de RAM de la base seleccionada
                    document.getElementById('base-ram-text').innerHTML = `<span class="text-green-333"><strong>${base.totalram} GB</strong> de RAM</span> <a href="${ram.link}" target="_blank" style="color: var(--color-link); margin-left:8px;"><i class="fas text-sm fa-external-link-alt"></i></a>`;
                    // Motherboard
                    document.getElementById('base-motherboard-text').innerHTML = `Mother <small>${motherboard.name}</small> <a href="${motherboard.link}" target="_blank" style="color: var(--color-link); margin-left:8px;"><i class="fas text-sm fa-external-link-alt"></i></a>`;
                    // Descripción desde el JSON
                    document.getElementById('base-description-text').innerHTML = base.description || '';
                    // Imagen
                    const baseImage = document.getElementById('base-image');
                    if (baseImage) baseImage.src = `comps/bases/${base.id}.webp`;
                    updateBaseSummaryText(cpu, ram, base);
                }
            }


            function updateTowerDisplay() {
                if (towersOptions.length === 0) return;
                const selectedTower = towersOptions[currentTowerIndex];
                loadImageWithGrayscale(document.getElementById('current-tower-image'), selectedTower.image_url);
                document.getElementById('current-tower-name').textContent = selectedTower.name;
                let towerPriceHTML = '';
                if (selectedTower.link) {
                    const priceFull = selectedTower.price > 0 ? `$${selectedTower.price.toLocaleString('es-AR')} | ` : '';
                    towerPriceHTML = `<a href="${selectedTower.link}" target="_blank" class="component-link">${priceFull}Detalle <i class="fas fa-external-link-alt"></i></a>`;
                }
                document.getElementById('current-tower-price-display').innerHTML = towerPriceHTML;
                updatePrices();
            }

            // --- REFACTORED: Single function to update component display ---
            function updateComponentDisplay(componentKey) {
                const config = {
                    gpu: { selectEl: document.getElementById('gpu-select'), descEl: document.getElementById('gpu-description'), imageEl: document.getElementById('gpu-image'), options: gpuOptions },
                    ssd: { selectEl: document.getElementById('ssd-select'), descEl: document.getElementById('ssd-description'), imageEl: document.getElementById('ssd-image'), options: ssdOptions },
                    psu: { selectEl: document.getElementById('psu-select'), descEl: document.getElementById('psu-description'), imageEl: document.getElementById('psu-image'), options: psuOptions }
                };

                const { descEl, imageEl, options } = config[componentKey];
                const selectedIndex = selectedComponentIndices[componentKey];
                const selectedOption = options[selectedIndex];

                if (selectedOption) {
                    if (descEl) {
                        let linkHTML = '';
                        if (selectedOption.link) {
                            const priceFull = selectedOption.price > 0 ? `$${selectedOption.price.toLocaleString('es-AR')} | ` : '';
                            linkHTML = `<a href="${selectedOption.link}" target="_blank" class="component-link block">${priceFull}Detalle <i class="fas fa-external-link-alt"></i></a>`;
                        }
                        descEl.innerHTML = selectedOption.description + linkHTML;
                    }
                    if (imageEl) loadImageWithGrayscale(imageEl, selectedOption.image_url);

                    if (componentKey === 'gpu') {
                        const gpuLi = document.getElementById('gpu-li');
                        if (selectedIndex === 0) { // Assuming "Integrada" is always the first option
                            imageEl.classList.add('md:block', 'hidden');
                            gpuLi.classList.add('gpu-integrated-mobile');
                        } else {
                            imageEl.classList.remove('md:block', 'hidden');
                            gpuLi.classList.remove('gpu-integrated-mobile');
                        }
                    }
                }
                updatePrices();
            }


            function updateSelectedComponentsDisplay() {
                const container = document.getElementById('selected-components-preview');
                if (!container) return;
                container.innerHTML = ''; // Clear previous content

                // Create main grid for cabinet and table
                const summaryGrid = document.createElement('div');
                summaryGrid.className = 'flex flex-col md:flex-row gap-8 items-start';

                // Left side: Cabinet
                const cabinetContainer = document.createElement('div');
                cabinetContainer.className = 'w-full md:w-1/3 flex-shrink-0 flex flex-col items-center -mt-8';
                // Responsive negative top margin for md and up
                cabinetContainer.style.marginTop = '-2rem'; // default for mobile
                cabinetContainer.classList.add('cabinet-summary-responsive');
                // Will be overridden by media query for md screens
                // Add this style block for responsive negative margin
                const style = document.createElement('style');
                style.innerHTML = `@media (min-width: 768px) { .cabinet-summary-responsive { margin-top: -8.5rem !important; } }`;
                document.head.appendChild(style);
                const selectedTower = towersOptions[currentTowerIndex];
                if (selectedTower) {
                    cabinetContainer.innerHTML = `
                        <a href="#main-components-container" class="block">
                            <img src="${selectedTower.image_url}" alt="${selectedTower.name}" style="width: 313px; height: 430px; object-fit: contain;" class="rounded-lg mb-2" onerror="this.onerror=null;this.src='https://placehold.co/313x430/1f2937/ffffff?text=Gabinete'">
                        </a>
                        <p class="font-bold text-lg text-white">${selectedTower.name}</p>
                        <a href="${selectedTower.link}" target="_blank" class="component-link">$${selectedTower.price.toLocaleString('es-AR')} <i class="fas fa-external-link-alt"></i></a>
                    `;
                }
                summaryGrid.appendChild(cabinetContainer);

                // Right side: Table
                const tableContainer = document.createElement('div');
                tableContainer.className = 'w-full md:w-2/3';
                // Nuevo: contenedores tipo card-row
                const cardRowsContainer = document.createElement('div');
                cardRowsContainer.className = 'flex flex-col gap-2 w-full';

                const components = [
                    { type: 'Gráfica', selected: gpuOptions[selectedComponentIndices.gpu] },
                    { type: 'Almacenamiento', selected: ssdOptions[selectedComponentIndices.ssd] },
                    { type: 'Fuente', selected: psuOptions[selectedComponentIndices.psu] }
                ];

                const peripheralMap = {
                    monitor: { options: monitorOptions, name: 'Monitor' }, keyboard: { options: keyboardOptions, name: 'Teclado' },
                    mouse: { options: mouseOptions, name: 'Mouse' }, auriculares: { options: auricularesOptions, name: 'Auriculares' },
                    parlantes: { options: parlantesOptions, name: 'Parlantes' }, microfono: { options: microfonosOptions, name: 'Micrófono' },
                    webcam: { options: webcamOptions, name: 'Webcam' }, arodeluz: { options: arosDeLuzOptions, name: 'Aro de Luz' },
                    wifi: { options: wifiOptions, name: 'WiFi' }
                };

                for (const key in selectedPeripherals) {
                    if (selectedPeripherals[key] > -1) {
                        const item = peripheralMap[key].options[selectedPeripherals[key]];
                        components.push({ type: peripheralMap[key].name, selected: item });
                    }
                }

                function createCardRow(type, selected, isService = false) {
                    const row = document.createElement('div');
                    row.className = 'card-row flex flex-col gap-1 p-2 rounded-lg bg-gray-800 border-b border-gray-700';
                    // Título arriba
                    const title = document.createElement('span');
                    title.className = 'font-bold text-green-400 px-2 py-1 rounded mb-1';
                    title.style.background = '#18122b';
                    title.style.display = 'block';
                    title.style.textAlign = 'left';
                    title.style.marginLeft = '-18px';
                    title.style.fontFamily = 'Inter, sans-serif';
                    title.textContent = type;
                    row.appendChild(title);
                    // Contenido: nombre y precio alineados horizontalmente
                    const contentRow = document.createElement('div');
                    contentRow.className = 'flex flex-row items-center justify-between w-full';
                    contentRow.style.fontFamily = 'Inter, sans-serif';
                    const nameEl = document.createElement('span');
                    nameEl.className = '';
                    if (!isService && selected?.name) {
                        // Map type to section id
                        let sectionId = null;
                        if (type === 'Gráfica') sectionId = 'gpu-select';
                        else if (type === 'Almacenamiento') sectionId = 'ssd-select';
                        else if (type === 'Fuente') sectionId = 'psu-select';
                        // For peripherals, scroll to #section-peripherals
                        else if ([
                            'Monitor', 'Teclado', 'Mouse', 'Auriculares', 'Parlantes', 'Micrófono', 'Webcam', 'Aro de Luz', 'WiFi'
                        ].includes(type)) sectionId = 'section-peripherals';
                        if (sectionId) {
                            nameEl.innerHTML = `<a href="#${sectionId}" class="component-link" style="font-size:1rem;color:white !important;font-family:Inter,sans-serif !important;" onclick="event.preventDefault();document.getElementById('${sectionId}').scrollIntoView({behavior:'smooth'});">${selected.name}</a>`;
                        } else {
                            nameEl.style.color = 'white';
                            nameEl.style.fontFamily = 'Inter, sans-serif';
                            nameEl.textContent = selected.name;
                        }
                    } else {
                        nameEl.textContent = isService ? 'Garantía + Soporte Técnico x 1 Año' : (selected?.name || '');
                        nameEl.style.fontFamily = 'Inter, sans-serif';
                    }
                    const priceEl = document.createElement('span');
                    // All prices use --color-link and Inter font
                    priceEl.style.color = 'var(--color-link)';
                    priceEl.style.fontFamily = 'Inter, sans-serif';
                    priceEl.style.fontWeight = 'bold';
                    if (isService) {
                        priceEl.textContent = `$${GAIN_PRICE.toLocaleString('es-AR')}`;
                    } else {
                        if (selected?.price > 0) {
                            if (selected?.link) {
                                priceEl.innerHTML = `<a href="${selected.link}" target="_blank" class="component-link" style="color:var(--color-link);font-family:Inter,sans-serif;font-weight:bold;">$${selected.price.toLocaleString('es-AR')} <i class="fas fa-external-link-alt"></i></a>`;
                            } else {
                                priceEl.innerHTML = `<span style="color:var(--color-link);font-family:Inter,sans-serif;font-weight:bold;">$${selected.price.toLocaleString('es-AR')}</span>`;
                            }
                        } else {
                            priceEl.textContent = 'Incluida';
                        }
                    }
                    contentRow.appendChild(nameEl);
                    contentRow.appendChild(priceEl);
                    row.appendChild(contentRow);
                    return row;
                }

                components.forEach(comp => {
                    if (comp.selected) {
                        cardRowsContainer.appendChild(createCardRow(comp.type, comp.selected));
                    }
                });
                // Armado y Servicio
                cardRowsContainer.appendChild(createCardRow('Instalación y Servicio', null, true));

                tableContainer.appendChild(cardRowsContainer);
                summaryGrid.appendChild(tableContainer);
                container.appendChild(summaryGrid);
            }

            // --- NEW PERIPHERAL FUNCTIONS ---
            function populateOptionalPeripherals() {
                const grid = document.getElementById('peripherals-grid');
                grid.innerHTML = '';
                const peripheralCategories = [
                    { key: 'monitor', name: 'Monitor', options: monitorOptions },
                    { key: 'keyboard', name: 'Teclado', options: keyboardOptions },
                    { key: 'mouse', name: 'Mouse', options: mouseOptions },
                    { key: 'auriculares', name: 'Auriculares', options: auricularesOptions },
                    { key: 'parlantes', name: 'Parlantes', options: parlantesOptions },
                    { key: 'microfono', name: 'Micrófono', options: microfonosOptions },
                    { key: 'webcam', name: 'Webcam', options: webcamOptions },
                    { key: 'arodeluz', name: 'Aro de Luz', options: arosDeLuzOptions },
                    { key: 'wifi', name: 'WiFi', options: wifiOptions }
                ];

                peripheralCategories.forEach(cat => {
                    if (cat.options.length > 0) {
                        const container = document.createElement('div');
                        container.className = 'peripheral-container';
                        container.dataset.category = cat.key;
                        container.innerHTML = `
                            <div class="summary-card unselected">
                                <div class="summary-card-image-wrapper">
                                   <img src="${cat.options[0].image_url}" alt="${cat.name}" onerror="this.onerror=null;this.src='https://placehold.co/240x190/ffffff/333333?text=${cat.name}'">
                                </div>
                            </div>
                            <div class="peripheral-info">
                                <p class="peripheral-name text-white">${cat.name}</p>
                                <div class="peripheral-price-container"><p class="component-link">&nbsp;</p></div>
                            </div>`;
                        grid.appendChild(container);
                    }
                });
            }

            function handlePeripheralClick(e) {
                const container = e.target.closest('.peripheral-container');
                if (!container || !e.target.closest('.summary-card-image-wrapper')) return;

                const category = container.dataset.category;
                if (!category) return;

                // If the click is on the summary section, do nothing (handled by <a> tag)
                if (container.closest('#selected-images-container')) {
                    return;
                }

                const collections = {
                    monitor: monitorOptions, keyboard: keyboardOptions, mouse: mouseOptions, auriculares: auricularesOptions,
                    parlantes: parlantesOptions, microfono: microfonosOptions, webcam: webcamOptions, arodeluz: arosDeLuzOptions, wifi: wifiOptions
                };
                const options = collections[category];

                let currentIndex = selectedPeripherals[category];

                currentIndex++;
                if (currentIndex >= options.length) {
                    currentIndex = -1; // Cycle back to unselected
                }
                selectedPeripherals[category] = currentIndex;

                const mainCardContainer = document.querySelector(`#peripherals-grid .peripheral-container[data-category="${category}"]`);
                if (mainCardContainer) {
                    mainCardContainer.classList.toggle('selected', currentIndex > -1);
                    updatePeripheralCard(mainCardContainer, currentIndex, options);
                }

                updatePrices();
            }

            function handleSummaryCardClick(e) {
                const link = e.target.closest('a');
                if (!link) return;

                const container = link.closest('.peripheral-container');
                if (container && container.dataset.category) {
                    const itemLink = container.querySelector('.component-link');
                    if (itemLink && itemLink.href && itemLink.href !== '#') {
                        window.open(itemLink.href, '_blank');
                    }
                } else if (link.href.includes('#')) {
                    // Internal link, let it scroll
                } else if (link.href) {
                    window.open(link.href, '_blank');
                }
            }


            function updatePeripheralCard(container, index, options) {
                const card = container.querySelector('.summary-card');
                const img = container.querySelector('img');
                const info = container.querySelector('.peripheral-info');
                const nameEl = info.querySelector('.peripheral-name');
                const priceContainer = info.querySelector('.peripheral-price-container');

                if (index === -1) {
                    card.classList.add('unselected');
                    img.src = options[0].image_url;
                    nameEl.textContent = container.dataset.category.charAt(0).toUpperCase() + container.dataset.category.slice(1);
                    priceContainer.innerHTML = `<p class="component-link">&nbsp;</p>`;
                } else {
                    card.classList.remove('unselected');
                    const item = options[index];
                    img.src = item.image_url;
                    nameEl.textContent = item.name;
                    let priceHTML = '&nbsp;';
                    if (item.price > 0 && item.link) {
                        priceHTML = `<a href="${item.link}" target="_blank" class="component-link" onclick="event.stopPropagation()">$${item.price.toLocaleString('es-AR')} <i class="fas fa-external-link-alt"></i></a>`;
                    } else if (item.price > 0) {
                        priceHTML = `<span class="component-link" style="color: var(--color-link);">$${item.price.toLocaleString('es-AR')}</span>`;
                    }
                    priceContainer.innerHTML = priceHTML;
                }
            }


            // --- EVENT HANDLERS & HELPERS ---
            function prevTower() {
                currentTowerIndex = (currentTowerIndex - 1 + towersOptions.length) % towersOptions.length;
                updateTowerDisplay();
            }

            function nextTower() {
                currentTowerIndex = (currentTowerIndex + 1) % towersOptions.length;
                updateTowerDisplay();
            }

            let errorToastTimeout;
            let consecutiveErrorClicks = 0;
            function showErrorToast(message) {
                const errorToast = document.getElementById('error-toast');
                const errorToastMessage = document.getElementById('error-toast-message');
                const resetSelectionBtn = document.getElementById('reset-selection-btn');
                clearTimeout(errorToastTimeout);
                errorToast.classList.remove('show');
                setTimeout(() => {
                    errorToastMessage.textContent = message;
                    if (consecutiveErrorClicks >= 2) resetSelectionBtn.classList.remove('hidden');
                    errorToast.classList.add('show');
                    errorToastTimeout = setTimeout(() => {
                        errorToast.classList.remove('show');
                        resetSelectionBtn.classList.add('hidden');
                    }, 4000);
                }, 150);
            }

            function handleGameSelectionChange(e) {
                if (e.target.checked && document.querySelectorAll('input[name="game"]:checked').length > 3) {
                    e.target.checked = false;
                    consecutiveErrorClicks++;
                    showErrorToast('MAX 3 Juegos Incluidos');
                    return;
                }
                consecutiveErrorClicks = 0;
                clearTimeout(errorToastTimeout);
                document.getElementById('error-toast').classList.remove('show');

                const sticker = e.target.nextElementSibling.querySelector('.game-title-sticker');
                if (e.target.checked) {
                    sticker.style.top = `${Math.floor(Math.random() * 50) + 15}%`;
                    sticker.style.left = `${Math.floor(Math.random() * 40) + 10}%`;
                    sticker.style.transform = `rotate(${Math.floor(Math.random() * 20) - 10}deg)`;
                    sticker.classList.remove('hidden');
                } else {
                    sticker.classList.add('hidden');
                }
                updateSelectedGamesList();
            }

            function updateSelectedGamesList() {
                // const selectedCheckboxes = document.querySelectorAll('input[name="game"]:checked');
                // const listEl = document.getElementById('selected-games-list');
                // const sectionEl = document.getElementById('selected-games-section');
                // listEl.innerHTML = '';
                // if (selectedCheckboxes.length > 0) {
                //     sectionEl.classList.remove('hidden');
                //     selectedCheckboxes.forEach(cb => {
                //         listEl.innerHTML += `<div class="w-1/4 md:w-1/5 p-1"><a href="#card-game-${toSlug(cb.value)}"><img src="${cb.dataset.imgSrc}" alt="Carátula de ${cb.value}" class="rounded-md shadow-lg w-full h-full object-cover" onerror="this.onerror=null;this.src='https://placehold.co/300x400/111827/4f46e5?text=${cb.value.replace(/\s/g, '+')}';"></a></div>`;
                //     });
                // } else {
                //     sectionEl.classList.add('hidden');
                // }
            }

            function resetGameSelection() {
                // document.querySelectorAll('input[name="game"]:checked').forEach(cb => {
                //     cb.checked = false;
                //     cb.nextElementSibling.querySelector('.game-title-sticker').classList.add('hidden');
                // });
                // updateSelectedGamesList();
                // document.getElementById('error-toast').classList.remove('show');
                // consecutiveErrorClicks = 0;
            }

            let isGridExpanded = false;
            function expandGameGrid() {
                document.getElementById('game-grid-wrapper').style.maxHeight = `${document.getElementById('game-list').scrollHeight}px`;
                document.getElementById('load-more-games').classList.add('hidden');
                document.getElementById('no-more-games').classList.remove('hidden');
                const overlay = document.getElementById('load-more-overlay');
                overlay.style.opacity = '0';
                overlay.style.pointerEvents = 'none';
                isGridExpanded = true;
            }

            function setInitialGridHeight() {
                const gameListContainer = document.getElementById('game-list');
                const allGameCards = Array.from(gameListContainer.children);
                if (isGridExpanded || !allGameCards.length) return;
                const cardHeight = allGameCards[0].offsetHeight;
                if (cardHeight === 0) { setTimeout(setInitialGridHeight, 100); return; }
                const gridGap = parseInt(window.getComputedStyle(gameListContainer).getPropertyValue('grid-row-gap')) || 24;
                const rowHeight = cardHeight + gridGap;
                const teaserHeight = rowHeight / 2;
                const targetHeight = (6 * rowHeight) - gridGap + teaserHeight;
                document.getElementById('game-grid-wrapper').style.maxHeight = `${targetHeight}px`;
            }

            function positionCroxImages() {
                const croxA = document.getElementById('home-crox-a');
                const croxB = document.getElementById('home-crox-b');
                const hookSection = document.querySelector('.hook-section');
                const wrapper = document.getElementById('hero-wrapper');
                if (croxA && croxB && hookSection && wrapper && window.innerWidth > 639) {
                    const wrapperRect = wrapper.getBoundingClientRect();
                    const hookSectionRect = hookSection.getBoundingClientRect();
                    const topPosition = hookSectionRect.top - wrapperRect.top - (croxA.offsetHeight / 2);
                    croxA.style.top = `${topPosition}px`;
                    croxB.style.top = `${topPosition}px`;
                    const marginPx = -10 * parseFloat(getComputedStyle(document.documentElement).fontSize);
                    croxA.style.left = `${hookSectionRect.left - wrapperRect.left - croxA.offsetWidth - marginPx + 33}px`;
                    croxB.style.right = `${wrapperRect.right - hookSectionRect.right - croxB.offsetWidth - marginPx + 56}px`;
                    croxB.style.left = 'auto';
                }
            }

            function showDolarPopup() {
                if (allDolarRates.length === 0) return;
                const dolarRatesList = document.getElementById('dolar-rates-list');
                dolarRatesList.innerHTML = '';
                const tiposPermitidos = [{ key: 'oficial', label: 'Oficial' }, { key: 'blue', label: 'Blue' }, { key: 'cripto', label: 'Cripto' }];
                let total = parseInt(document.getElementById('total-price').textContent.replace(/\$|\./g, ''));

                tiposPermitidos.forEach(tipo => {
                    const rate = allDolarRates.find(r => r.nombre.toLowerCase().includes(tipo.key));
                    if (!rate) return;
                    const precioEnDolar = rate.venta ? (total / rate.venta).toFixed(0) : '-';
                    dolarRatesList.innerHTML += `<div class="flex flex-col gap-1 mb-3 border-b border-gray-700/50 pb-2 dolar-rate-item"><span class="font-bold text-gray-300 dolar-name">${tipo.label}</span><div class="text-right"><span class="text-gray-400">Compra: </span><span class="font-mono text-green-400">$${rate.compra}</span><br><span class="text-gray-400">Venta: </span><span class="font-mono text-green-400">$${rate.venta}</span></div><div class="font-saira text-violet-400 font-bold text-lg text-center mt-1">serían $${precioEnDolar} USD</div></div>`;
                });
                document.getElementById('google-link').href = `https://www.google.com/search?q=${total}+ars+to+usd`;
                document.getElementById('dolar-popup').style.display = 'flex';
            }

            // ================== NEW AI FUNCTION (CORRECTED) ==================
            async function checkGameCompatibility() {
                const gameName = document.getElementById('ai-input').value.trim();
                const button = document.getElementById('ai-button');
                const resultContainer = document.getElementById('ai-result');
                const placeholder = document.getElementById('ai-placeholder');
                const loader = document.getElementById('ai-loader');

                if (!gameName) {
                    alert("Por favor, ingresá el nombre de un juego.");
                    return;
                }

                // --- 1. Gather component data (now using indices) ---
                const baseConfig = baseOptions[currentBaseLevel];
                const cpu = cpuOptions.find(c => String(c.id) === String(baseConfig.cpu));
                const totalRam = baseConfig.totalram;
                const selectedGpu = gpuOptions[selectedComponentIndices.gpu];
                const selectedSsd = ssdOptions[selectedComponentIndices.ssd];

                // --- 2. Show loading state ---
                button.disabled = true;
                button.querySelector('span').textContent = 'Analizando...';
                placeholder.classList.add('hidden');
                resultContainer.innerHTML = ''; // Clear previous results
                loader.classList.remove('hidden');

                // --- 3. Call local API route ---
                try {
                    const response = await fetch('/api/analyze', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            gameName,
                            components: {
                                cpu,
                                totalRam,
                                selectedGpu,
                                selectedSsd
                            },
                            availableGpus: gpuOptions,
                            availableCpus: cpuOptions 
                        })
                    });

                    if (!response.ok) {
                        const errorBody = await response.json();
                        console.error("API Error Response:", errorBody);
                        throw new Error(`Error de API: ${response.status} ${response.statusText}`);
                    }

                    const data = await response.json();
                    let text = data.result || '';
                    // Limpieza de saltos de línea extra
                    text = text.trim(); // quita saltos al inicio y final
                    // Elimina cualquier salto de línea antes del primer punto numerado
                    text = text.replace(/^\s*\n*(\d+\.)/, '$1');
                    // Reemplaza 2 o más saltos de línea seguidos por solo uno
                    text = text.replace(/\n{2,}/g, '\n');
                    // Opcional: elimina saltos de línea antes/después de los puntos numerados
                    text = text.replace(/\n+(\d+\.)/g, '\n$1');
                    // --- 4. Display the result ---
                    // Highlight CPU and GPU names with green rounded span and link
                    let htmlResult = text
                        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>') // Bold
                        .replace(/\*(.*?)\*/g, '<em>$1</em>')     // Italic
                        .replace(/(\d+\.)/g, '<br><strong>$1</strong>') // Numbered list items
                        .replace(/\n/g, '<br>');

                    // Get current CPU and GPU names
                    const cpuName = cpuOptions[selectedComponentIndices.cpu]?.name || cpuOptions.find(c => String(c.id) === String(baseOptions[currentBaseLevel].cpu))?.name;
                    const gpuName = gpuOptions[selectedComponentIndices.gpu]?.name;

                    // Replace CPU name with highlighted span and selection logic
                    if (cpuName) {
                        const cpuRegex = new RegExp(cpuName.replace(/[.*+?^${}()|[\]\\]/g, '\$&'), 'gi');
                        htmlResult = htmlResult.replace(cpuRegex, `<span class='green-333 font-saira px-2 py-1 rounded-lg cursor-pointer inline-block' style='background:#18122b;' data-component-type='cpu' data-component-name='${cpuName}'>${cpuName}</span>`);
                    }
                    // Highlight all GPU names from the collection that appear in the AI response
                    if (gpuOptions && gpuOptions.length > 0) {
                        let alreadyHighlighted = new Set();
                        // Helper para normalizar nombres
                        function normalize(str) {
                            return str.toLowerCase().replace(/\s|\-|_/g, '');
                        }
                        // Construir lista de keywords únicas
                        let allKeywords = [];
                        gpuOptions.forEach(gpu => {
                            allKeywords.push(gpu.name);
                            if (gpu.name.includes('-')) {
                                allKeywords.push(gpu.name.split('-')[0].trim());
                            }
                        });
                        // Eliminar duplicados
                        allKeywords = Array.from(new Set(allKeywords.filter(k => k.length > 2)));
                        // Reemplazo global con regex que permite espacios, guiones y números
                        allKeywords.forEach(keyword => {
                            // Escapar correctamente y permitir coincidencias completas
                            const escaped = keyword.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
                            // Coincidencia: palabra completa, no parte de otra palabra
                            const regex = new RegExp(`(?<![\w\d])${escaped}(?![\w\d])`, 'gi');
                            htmlResult = htmlResult.replace(regex, match => {
                                const norm = normalize(match);
                                if (!alreadyHighlighted.has(norm)) {
                                    alreadyHighlighted.add(norm);
                                    // Buscar el objeto GPU original para el nombre
                                    const gpuObj = gpuOptions.find(g => normalize(g.name) === norm || normalize(g.name.split('-')[0]) === norm);
                                    const gpuNameForSpan = gpuObj ? gpuObj.name : match;
                                    return `<span class='green-333 font-saira px-2 py-1 rounded-lg cursor-pointer inline-block' style='background:#18122b;' data-component-type='gpu' data-component-name='${gpuNameForSpan}'>${match}</span>`;
                                }
                                return match;
                            });
                        });
                    }

                    // Add event listeners to highlighted spans for selection and scroll
                    setTimeout(() => {
                        document.querySelectorAll('#ai-result span[data-component-type]').forEach(span => {
                            span.onclick = function () {
                                const type = span.getAttribute('data-component-type');
                                const name = span.getAttribute('data-component-name');
                                if (type === 'gpu') {
                                    const select = document.getElementById('gpu-select');
                                    if (select) {
                                        for (let i = 0; i < select.options.length; i++) {
                                            if (select.options[i].textContent.trim().toLowerCase().includes(name.trim().toLowerCase())) {
                                                select.selectedIndex = i;
                                                select.dispatchEvent(new Event('change'));
                                                break;
                                            }
                                        }
                                        document.getElementById('component-list').scrollIntoView({ behavior: 'smooth' });
                                    }
                                } else if (type === 'cpu') {
                                    document.getElementById('section-bases').scrollIntoView({ behavior: 'smooth' });
                                    // Opcional: si tienes un select de CPU, puedes agregar lógica similar aquí
                                }
                            };
                        });
                    }, 100);
                    // Elimina el primer <br> si existe
                    htmlResult = htmlResult.replace(/^<br\s*\/?>/, '');
                    resultContainer.innerHTML = htmlResult;

                } catch (error) {
                    console.error("Error al llamar a la API local:", error);
                    resultContainer.innerHTML = `<p class="text-red-400">¡Ups! Hubo un error al contactar a la IA. Verificá la consola (F12) para más detalles.</p>`;
                } finally {
                    loader.classList.add('hidden');
                    button.disabled = false;
                    button.querySelector('span').textContent = 'Analizar';
                }
            }


            function handleFormSubmit(e) {
                e.preventDefault();
                const selectedGames = Array.from(document.querySelectorAll('input[name="game"]:checked')).map(cb => cb.value);
                const selectedSoftware = Array.from(document.querySelectorAll('.custom-software-checkbox.checked')).map(cb => softwareData.find(s => s.slug === cb.dataset.slug)?.name).filter(Boolean);
                const extraNotes = document.getElementById('extra-notes').value;

                // --- REFACTORED: Get component names from selected indices ---
                const selectedGpuName = gpuOptions[selectedComponentIndices.gpu].name;
                const selectedSsdName = ssdOptions[selectedComponentIndices.ssd].name;
                const selectedPsuName = psuOptions[selectedComponentIndices.psu].name;

                let message = `¡Hola, me interesa esta Nave del Medio!\n\n`;
                message += `*Torre:* ${towersOptions[currentTowerIndex].name}\n`;
                message += `*Almacenamiento:* ${selectedSsdName}\n`;
                message += `*Gráfica:* ${selectedGpuName}\n`;
                message += `*Fuente:* ${selectedPsuName}\n`;

                let peripheralsMessage = '';
                const peripheralMap = {
                    monitor: { options: monitorOptions, name: 'Monitor' },
                    keyboard: { options: keyboardOptions, name: 'Teclado' },
                    mouse: { options: mouseOptions, name: 'Mouse' },
                    auriculares: { options: auricularesOptions, name: 'Auriculares' },
                    parlantes: { options: parlantesOptions, name: 'Parlantes' },
                    microfono: { options: microfonosOptions, name: 'Micrófono' },
                    webcam: { options: webcamOptions, name: 'Webcam' },
                    arodeluz: { options: arosDeLuzOptions, name: 'Aro de Luz' },
                    wifi: { options: wifiOptions, name: 'WiFi' }
                };
                for (const key in selectedPeripherals) {
                    if (selectedPeripherals[key] > -1) {
                        const item = peripheralMap[key].options[selectedPeripherals[key]];
                        peripheralsMessage += `${peripheralsMessage ? ', ' : ''}${peripheralMap[key].name}: ${item.name}`;
                    }
                }
                if (peripheralsMessage) message += `*Periféricos:* ${peripheralsMessage}\n`;

                if (selectedGames.length > 0) message += `*Juegos:* ${selectedGames.join(', ')}\n`;
                if (selectedSoftware.length > 0) {
                    message += `*Programas:*\n`;
                    ['Sistema', 'Multimedia', 'Web', 'Creación', 'Desarrollo'].forEach(cat => {
                        const programs = selectedSoftware.filter(name => softwareData.find(p => p.name === name)?.category === cat);
                        if (programs.length > 0) message += `- ${cat}: ${programs.join(', ')}\n`;
                    });
                }
                if (extraNotes.trim() !== '') message += `*Notas:* ${extraNotes}\n`;

                message += `\nPrecio Total: ${document.getElementById('top-total-price').textContent}`;
                message += `\n¡Quedo a la espera de tu respuesta!`;
                window.open(`https://wa.me/5492252513233?text=${encodeURIComponent(message)}`, '_blank');
            }

            function loadImageWithGrayscale(imageElement, newSrc) {
                if (!imageElement) return;
                imageElement.classList.add('loading');
                const tempImage = new Image();
                tempImage.src = newSrc;
                tempImage.onload = () => {
                    imageElement.src = newSrc;
                    imageElement.classList.remove('loading');
                };
                tempImage.onerror = () => {
                    console.error(`Failed to load image: ${newSrc}`);
                    imageElement.classList.remove('loading');
                };
            }

            function updateSliderPosition() {
                const slider = document.getElementById('base-level-slider');
                const activeTab = document.querySelector('.base-level-tab.active');
                if (slider && activeTab) {
                    slider.style.width = `${activeTab.offsetWidth}px`;
                    slider.style.left = `${activeTab.offsetLeft}px`;
                }
            }
        });
        // ...existing code...
        // Ejemplo: asume que ya tienes baseOptions, ramOptions, cpuOptions, motherboardOptions cargados desde el JSON


        function updateBaseSummaryText(cpu, ram, base) {
            const summaryEl = document.getElementById('base-summary-text');
            if (summaryEl && base) {
                // Use same style as other component names: white, not underlined, font-saira
                summaryEl.innerHTML = `<span class='font-saira green-333' style='font-size:1.6rem;'>${base.name}</span>`;
                const basePriceEl = document.getElementById('base-price-text');
                if (basePriceEl) {
                    basePriceEl.innerHTML = `<a href='#section-bases' class='component-link text-blue-400 font-bold' style='font-size:1.15rem;display:inline-flex;align-items:center;text-decoration:none;' onclick="event.preventDefault();document.getElementById('section-bases').scrollIntoView({behavior:'smooth'});">$${base.total.toLocaleString('es-AR')} <i class='fas text-sm fa-external-link-alt ml-1'></i></a>`;
                }
            }
        }
        // ...existing code...
    </script>
</body>

</html>